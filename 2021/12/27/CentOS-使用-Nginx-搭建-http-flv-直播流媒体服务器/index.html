<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>CentOS 使用 Nginx 搭建 http-flv 直播流媒体服务器 | RenChing</title><meta name="description" content="CentOS 使用 Nginx 搭建 http-flv 直播流媒体服务器"><meta name="keywords" content="Centos,Nginx,流媒体服务器,http-flv"><meta name="author" content="RenChing Doe"><meta name="copyright" content="RenChing Doe"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://yoursite.com/2021/12/27/CentOS-使用-Nginx-搭建-http-flv-直播流媒体服务器/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="CentOS 使用 Nginx 搭建 http-flv 直播流媒体服务器"><meta name="twitter:description" content="CentOS 使用 Nginx 搭建 http-flv 直播流媒体服务器"><meta name="twitter:image" content="https://img.trickyedecay.me/FufGyYAvIh817tYtkIRlsUkDHzz-"><meta property="og:type" content="article"><meta property="og:title" content="CentOS 使用 Nginx 搭建 http-flv 直播流媒体服务器"><meta property="og:url" content="http://yoursite.com/2021/12/27/CentOS-使用-Nginx-搭建-http-flv-直播流媒体服务器/"><meta property="og:site_name" content="RenChing"><meta property="og:description" content="CentOS 使用 Nginx 搭建 http-flv 直播流媒体服务器"><meta property="og:image" content="https://img.trickyedecay.me/FufGyYAvIh817tYtkIRlsUkDHzz-"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="Debian 系统解决中文乱码问题" href="http://yoursite.com/2021/12/27/Debian-系统解决中文乱码问题/"><link rel="next" title="CentOS 7 yum 方式安装 MySQL5.7" href="http://yoursite.com/2021/12/27/CentOS-7-yum-方式安装-MySQL5-7/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://renqingsangbu.github.io","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Bookmark',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days'

  
}</script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CentOS-使用-Nginx-搭建-http-flv-直播流媒体服务器"><span class="toc-text">CentOS 使用 Nginx 搭建 http-flv 直播流媒体服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#前置知识"><span class="toc-text">前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RTMP"><span class="toc-text">RTMP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-FLV"><span class="toc-text">HTTP-FLV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HLS"><span class="toc-text">HLS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#下载源代码"><span class="toc-text">下载源代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装依赖"><span class="toc-text">安装依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编译安装-Nginx"><span class="toc-text">编译安装 Nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编辑-Nginx-配置文件"><span class="toc-text">编辑 Nginx 配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检查-Nginx-配置文件"><span class="toc-text">检查 Nginx 配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动-Nginx"><span class="toc-text">启动 Nginx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-OBS-推流"><span class="toc-text">使用 OBS 推流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-VLC-拉流"><span class="toc-text">使用 VLC 拉流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-flv-js-Web-拉流"><span class="toc-text">使用 flv.js Web 拉流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-FFmpeg-推流"><span class="toc-text">使用 FFmpeg 推流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://img.trickyedecay.me/FufGyYAvIh817tYtkIRlsUkDHzz-)"><div id="page-header"><span class="pull-left"> <a class="blog_title" id="site-name" href="/">RenChing</a></span><div class="open toggle-menu pull-right"><div class="menu-icon-first"></div><div class="menu-icon-second"></div><div class="menu-icon-third"></div></div><span class="pull-right menus"><div class="mobile_author_icon"><img class="lozad" data-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'"><div class="mobile_author-info__description"></div></div><hr><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标籤</span></a><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title"><div class="posttitle">CentOS 使用 Nginx 搭建 http-flv 直播流媒体服务器</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2021-12-27<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> Updated 2021-12-27</time></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="CentOS-使用-Nginx-搭建-http-flv-直播流媒体服务器"><a href="#CentOS-使用-Nginx-搭建-http-flv-直播流媒体服务器" class="headerlink" title="CentOS 使用 Nginx 搭建 http-flv 直播流媒体服务器"></a>CentOS 使用 Nginx 搭建 http-flv 直播流媒体服务器</h1><h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><p>在搭建服务器之前，需要对直播这个概念本身有一个大概的理解。</p>
<p>经常听到两个词：<strong>推流(push/upstream)</strong> 和 <strong>拉流(pull/downstream)</strong></p>
<p><strong>推流</strong>：大概指的是将从某设备上采集到的画面、音频上传到直播流媒体服务器上。</p>
<p><strong>拉流</strong>：大概指的是从直播流媒体服务器上下载那些推流上来的东西。</p>
<p><img src="https://img.trickyedecay.me/FufGyYAvIh817tYtkIRlsUkDHzz-" alt="推流&amp;拉流"></p>
<p>信息在网络中传播一定要遵循某种协议，否则就乱套了，那么这些所谓的 <strong>流</strong> 在网络中传播，又有哪些可以遵循的协议呢？这里大概列举我认识的3个：</p>
<h3 id="RTMP"><a href="#RTMP" class="headerlink" title="RTMP"></a>RTMP</h3><p>RTMP 协议是 Adobe 公司设计的一个基于 <code>TCP</code> 传输的协议，被设计用来对基于底层传输协议的多媒体传输流（如音频、视频和交互数据）进行复用和分包。</p>
<p>RTMP 协议是目前最主流的传输协议，但是它最大的问题是，如果需要在浏览器上进行拉流，那么浏览器本身需要支持 <strong>flash</strong>，而当前众多浏览器厂商已经默认禁用了flash，对于用户体验十分不友好。</p>
<h3 id="HTTP-FLV"><a href="#HTTP-FLV" class="headerlink" title="HTTP-FLV"></a>HTTP-FLV</h3><p><strong>flv(flash video)</strong> 本身是一种视频格式，也是 Adobe 公司推出的，在网络上传输的视频大多都是以这种格式封装的。而 <strong>http-flv</strong> 则是将推流推上来的流媒体数据封装成 <strong>flv</strong> ，并且通过 <code>HTTP</code> 协议进行传输的协议。需要浏览器端支持播放 flv 格式的视频才可以。</p>
<blockquote>
<p>在本文中，推流使用的协议是 rtmp ，而拉流时使用的协议是 http-flv。</p>
</blockquote>
<h3 id="HLS"><a href="#HLS" class="headerlink" title="HLS"></a>HLS</h3><p><strong>HLS(Http Live Streaming)</strong> 是苹果提出的基于 <code>HTTP</code> 的流媒体传输协议，他的大致原理是将一个大的视频数据文件切分成若干个小的视频文件，然后客户端拉流的时候依照顺序一个一个地将小视频文件拉下来。HLS最大的优点就是，HTML5可以直接打开播放。</p>
<h2 id="下载源代码"><a href="#下载源代码" class="headerlink" title="下载源代码"></a>下载源代码</h2><blockquote>
<p>为了让 nginx 拥有处理流媒体的能力，需要通过 <code>编译安装</code> 的方式来安装 nginx。</p>
</blockquote>
<blockquote>
<p>由于是需要搭建一个基于 <code>http-flv</code> 的流媒体服务器，所以在编译时需要为 nginx 添加 <a href="https://github.com/winshining/nginx-http-flv-module" target="_blank" rel="noopener">nginx-http-flv-module</a> 模块。</p>
</blockquote>
<p>Nginx 下载地址：<a href="https://nginx.org/download/nginx-1.20.1.tar.gz" target="_blank" rel="noopener">https://nginx.org/download/nginx-1.20.1.tar.gz</a></p>
<p>nginx-http-flv-module 下载地址：<a href="https://github.com/winshining/nginx-http-flv-module/archive/refs/heads/master.zip" target="_blank" rel="noopener">https://github.com/winshining/nginx-http-flv-module/archive/refs/heads/master.zip</a></p>
<blockquote>
<p><strong>将源码包 nginx-1.20.1.tar.gz、nginx-http-flv-module-master.zip 上传到服务器 /tmp 目录下</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 进入 /tmp 目录</span><br><span class="line">cd /tmp</span><br><span class="line"></span><br><span class="line"># 查看 /tmp 目录</span><br><span class="line">ls</span><br><span class="line">nginx-1.20.1.tar.gz  nginx-http-flv-module-master.zip</span><br></pre></td></tr></table></figure>

<blockquote>
<p>解压 nginx-http-flv-module-master.zip 包</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip nginx-http-flv-module-master.zip</span><br></pre></td></tr></table></figure>

<blockquote>
<p>解压刚刚下载的 <code>nginx</code>，并进入到 nginx 的目录</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf nginx-1.20.1.tar.gz</span><br><span class="line">cd nginx-1.20.1</span><br></pre></td></tr></table></figure>

<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install unzip gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel</span><br></pre></td></tr></table></figure>

<h2 id="编译安装-Nginx"><a href="#编译安装-Nginx" class="headerlink" title="编译安装 Nginx"></a>编译安装 Nginx</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure --add-module=/tmp/nginx-http-flv-module-master --with-http_ssl_module</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这么一个过程下来后，<code>nginx</code> 会被安装在 <code>/usr/local/nginx</code> 底下。</p>
<p>需要注意的是，<code>nginx-http-flv-module</code> 是基于 <code>nginx-rtmp-module</code> 开发的，完全兼容 <code>nginx-rtmp-module</code> 的所有功能，所以<strong>在编译时无需重复添加</strong> <code>nginx-rtmp-module</code> 模块。</p>
<p>上述命令中还包含了 <code>--with-http_ssl_module</code> 参数，是根据 <code>nginx-rtmp-module</code> 的<a href="https://github.com/arut/nginx-rtmp-module#Build" target="_blank" rel="noopener">编译安装说明</a>进行的。</p>
</blockquote>
<h2 id="编辑-Nginx-配置文件"><a href="#编辑-Nginx-配置文件" class="headerlink" title="编辑 Nginx 配置文件"></a>编辑 Nginx 配置文件</h2><blockquote>
<p>使用 vi 或其他编辑工具编辑 <code>/usr/local/nginx/conf/nginx.conf</code> ，内容如下：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log  logs/error.log;</span><br><span class="line">pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rtmp &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 9999;  # 接受推流的端口号</span><br><span class="line">        chunk_size 8192; # 单一推流数据包的最大容量？</span><br><span class="line"></span><br><span class="line">        application myapp &#123; # myapp 模块，可以自行更换名字</span><br><span class="line">            live on; # 打开直播</span><br><span class="line">            meta off; # 为了兼容网页前端的 flv.js，设置为 off 可以避免报错</span><br><span class="line">            gop_cache on; # 支持GOP缓存，以减少首屏时间</span><br><span class="line">            allow play all; # 允许来自任何 ip 的人拉流</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;  # http 服务的端口</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location /live &#123; # 拉流时的 uri ，可以自行修改</span><br><span class="line">            flv_live on; # 打开 http-flv 服务</span><br><span class="line">            chunked_transfer_encoding on;</span><br><span class="line">            add_header &apos;Access-Control-Allow-Origin&apos; &apos;*&apos;; # 允许跨域</span><br><span class="line">            add_header &apos;Access-Control-Allow-Credentials&apos; &apos;true&apos;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="检查-Nginx-配置文件"><a href="#检查-Nginx-配置文件" class="headerlink" title="检查 Nginx 配置文件"></a>检查 Nginx 配置文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 进入 nginx 安装目录</span><br><span class="line">cd /usr/local/nginx</span><br><span class="line"></span><br><span class="line"># 检查 nginx 配置文件</span><br><span class="line">sbin/nginx -t</span><br><span class="line"># 输出结果如下</span><br><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span><br></pre></td></tr></table></figure>

<h2 id="启动-Nginx"><a href="#启动-Nginx" class="headerlink" title="启动 Nginx"></a>启动 Nginx</h2><blockquote>
<p>启动位于 <code>/usr/local/nginx/sbin</code> 目录下的 nginx</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 进入 nginx 安装目录</span><br><span class="line">cd /usr/local/nginx</span><br><span class="line"></span><br><span class="line"># 启动 nginx</span><br><span class="line">sbin/nginx</span><br><span class="line"></span><br><span class="line"># 查看 nginx、rtmp端口是否监听</span><br><span class="line">netstat -lnpt | egrep &quot;80|9999&quot;</span><br><span class="line"># 输出结果如下</span><br><span class="line">tcp        0      0 0.0.0.0:9999            0.0.0.0:*               LISTEN      22977/nginx: master </span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      22977/nginx: master</span><br></pre></td></tr></table></figure>

<p><strong>当使用如上配置开启 Nginx 时，推流和拉流的地址分别是这样：</strong></p>
<blockquote>
<ul>
<li>rtmp 推流地址: <code>rtmp://服务器IP:9999/myapp/mystream</code></li>
<li>rtmp 拉流地址：<code>rtmp://服务器IP:9999/myapp/mystream</code></li>
<li>flv 拉流地址：<code>http://服务器IP/live/?port=9999&amp;app=myapp&amp;stream=mystream</code></li>
</ul>
</blockquote>
<p>其中的 <code>myapp</code>指的是配置文件(nginx.conf)中 <code>rtmp</code> 块指定的 <code>application</code>，一个 <code>rtmp server</code> 可以拥有多个 <code>application</code>，只要名字对应的上，叫啥都可以。</p>
<p>示例地址中的 <code>mystream</code> 可以由用户自己指定，只要拉流地址的参数<code>stream</code>对应的上就行了，有点类似于房间的概念，推流要推到哪个<code>application</code>底下的哪个房间的感觉。</p>
<h2 id="使用-OBS-推流"><a href="#使用-OBS-推流" class="headerlink" title="使用 OBS 推流"></a>使用 OBS 推流</h2><blockquote>
<p>这里使用的是 <a href="https://obsproject.com/download" target="_blank" rel="noopener">OBS</a> 软件进行推流，打开 <code>OBS 设置面板 &gt; 推流</code></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/921d0e74beb344f7ac2d58d69e8906a6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/84e2e62704fe4dd9b7f643e399c0d030.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<blockquote>
<ol>
<li>将服务设置为: <code>自定义</code></li>
<li>服务器设置为不包含流名的推流地址示例: <code>rtmp://192.168.71.111:9999/myapp/</code></li>
<li>流秘钥设置为流名: <code>mystream</code></li>
<li>注：不同版本的 OBS 界面可能稍微有点不同</li>
</ol>
</blockquote>
<blockquote>
<p>打开 <code>OBS 左下角来源 + 号 &gt; 媒体源 &gt; 新建</code></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/0ea568a8943a49a09093296473de7c97.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/52e4af6737f34b3fa98e71f840e5580b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_17,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/f662ad89dae44f12a8584837b7628ffd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_11,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<blockquote>
<p>点击  <code>预览 &gt; 选择需要推流的视频 &gt; 打开 &gt; 确定</code></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/51c83d15d1174053be903c5d601bb15d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/fcb5835035c44669a1bd8c1cc7b34b0e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<blockquote>
<p>点击  <code>开始推流</code></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/e145e1660c704dcb9df14f1c993a385a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<blockquote>
<p>开始推流后下方即可看到推流状态信息</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/8d844ab1ea1f4627a25fb300d790b680.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<h2 id="使用-VLC-拉流"><a href="#使用-VLC-拉流" class="headerlink" title="使用 VLC 拉流"></a>使用 VLC 拉流</h2><blockquote>
<p>因为这里服务器IP地址为：<code>192.168.71.111</code>，所以以上推流对应拉流地址为如下：</p>
</blockquote>
<blockquote>
<p>rtmp 拉流地址：<code>rtmp://192.168.71.111:9999/myapp/mystream</code></p>
<p>flv 拉流地址：<code>http://192.168.71.111/live?port=9999&amp;app=myapp&amp;stream=mystream</code></p>
</blockquote>
<p><strong>rtmp 拉流结果：</strong></p>
<p><img src="https://img-blog.csdnimg.cn/1c539d78935f486fbedc288876399806.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/9123fc6c9d164ec2a53c43019658e7fc.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p><strong>flv 拉流结果：</strong></p>
<p><img src="https://img-blog.csdnimg.cn/063062ed6e6a4372a7b7c033b4e4fa8d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/27e7f572f1b84cdd848f83a128e0388b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<h2 id="使用-flv-js-Web-拉流"><a href="#使用-flv-js-Web-拉流" class="headerlink" title="使用 flv.js Web 拉流"></a>使用 flv.js Web 拉流</h2><blockquote>
<p>通过 <a href="https://github.com/bilibili/flv.js" target="_blank" rel="noopener">flv.js</a> 可以直接在网页上播放我们刚刚进行推流的音视频。</p>
</blockquote>
<blockquote>
<p>flv.js 在线测试地址：<a href="http://bilibili.github.io/flv.js/demo/" target="_blank" rel="noopener">http://bilibili.github.io/flv.js/demo/</a></p>
</blockquote>
<p><strong>运行效果：</strong></p>
<p><img src="https://img-blog.csdnimg.cn/9f7d324860f84b7ca21c227c185e47c3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/f55721ded6c34faaa3318cab12b7699e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<h2 id="使用-FFmpeg-推流"><a href="#使用-FFmpeg-推流" class="headerlink" title="使用 FFmpeg 推流"></a>使用 FFmpeg 推流</h2><blockquote>
<p>首先推送直播流到电脑（可以是同 nginx 一台服务器，性能会更好）必须已经安装了 ffmpeg 到环境。</p>
<p>FFmpeg在CentOS 7核心存储库中不可用。可以选择<a href="https://trac.ffmpeg.org/wiki/CompilationGuide/Centos" target="_blank" rel="noopener">从源代码</a>构建FFmpeg工具，也可以使用Nux Dextop存储库中的yum进行安装。这里将选择第二个选项。</p>
</blockquote>
<p><strong>Nux资料库取决于<a href="https://www.myfreax.com/how-to-enable-epel-repository-on-centos/" target="_blank" rel="noopener"> EPEL </a>软件资料库。如果您的系统上未启用EPEL存储库，请通过键入以下内容启用它：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br></pre></td></tr></table></figure>

<p><strong>导入存储库GPG密钥并通过<a href="https://www.myfreax.com/how-to-install-rpm-packages-on-centos/" target="_blank" rel="noopener">安装rpm软件包来启用Nux存储库</a>：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -v --import http://li.nux.ro/download/nux/RPM-GPG-KEY-nux.ro</span><br><span class="line">rpm -Uvh http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-5.el7.nux.noarch.rpm</span><br></pre></td></tr></table></figure>

<p><strong>安装FFmpeg：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install ffmpeg ffmpeg-devel</span><br></pre></td></tr></table></figure>

<p><strong>通过运行<code>ffmpeg -version</code>命令验证 FFmpeg 安装：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -version</span><br></pre></td></tr></table></figure>

<p><strong>ffmpeg 推送 RTMP 直播流到 nginx：</strong></p>
<blockquote>
<p>通过以上到 nginx 配置后，可以使用端口 <code>9999</code>，应用名称 <code>myapp</code> 来进行推送 RTMP 流给服务器，这里服务器IP为“ <code>192.168.71.111</code> ” 。</p>
</blockquote>
<p><strong>使用以下 <code>ffmpeg</code> 命令即可推流：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -re -i rtmp://192.168.71.111:9999/myapp/mystream -c copy -f flv rtmp://192.168.71.111:9999/myapp/flvlive</span><br></pre></td></tr></table></figure>

<blockquote>
<p>以上参数简单解释：9999 为端口，myapp 为对应 nginx 配置的应用名称，flvlive 为直播流名称可以随意填写，后面可以用这个名称，具体配置解释文档进行查阅：<a href="https://github.com/winshining/nginx-http-flv-module" target="_blank" rel="noopener">https://github.com/winshining/nginx-http-flv-module</a></p>
</blockquote>
<p><strong>运行正常结果如下图所示：</strong></p>
<p><img src="https://img-blog.csdnimg.cn/d67859b0f8034eb78b6353978b0a57e7.png" alt="在这里插入图片描述"></p>
<p><strong>拉流测试：</strong></p>
<blockquote>
<p>通过 <a href="https://github.com/bilibili/flv.js" target="_blank" rel="noopener">flv.js</a> 可以直接在网页上播放我们刚刚进行推流的音视频。</p>
</blockquote>
<blockquote>
<p>flv.js 在线测试地址：<a href="http://bilibili.github.io/flv.js/demo/" target="_blank" rel="noopener">http://bilibili.github.io/flv.js/demo/</a></p>
</blockquote>
<blockquote>
<p>rtmp 拉流地址：<code>rtmp://192.168.71.111:9999/myapp/flvlive</code></p>
<p>flv 拉流地址：<code>http://192.168.71.111/live?port=9999&amp;app=myapp&amp;stream=flvlive</code></p>
</blockquote>
<p><strong>rtmp 拉流结果</strong></p>
<p><img src="https://img-blog.csdnimg.cn/ad5367ef2eae4be18a645293e716879a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<p><strong>flv 拉流结果</strong></p>
<p><img src="https://img-blog.csdnimg.cn/e257a93d7cc74030897f9f4f26cbcc11.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><strong>至此，基于 rtmp 的推拉流的 Nginx 服务器就算是完成了。</strong></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">RenChing Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2021/12/27/CentOS-使用-Nginx-搭建-http-flv-直播流媒体服务器/">http://yoursite.com/2021/12/27/CentOS-使用-Nginx-搭建-http-flv-直播流媒体服务器/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Centos/">Centos    </a><a class="post-meta__tags" href="/tags/Nginx/">Nginx    </a><a class="post-meta__tags" href="/tags/流媒体服务器/">流媒体服务器    </a><a class="post-meta__tags" href="/tags/http-flv/">http-flv    </a></div><div class="post_share"><div class="social-share" data-image="https://img.trickyedecay.me/FufGyYAvIh817tYtkIRlsUkDHzz-" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-buttom"><i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/alipay.jpg"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2021/12/27/Debian-系统解决中文乱码问题/"><img class="prev_cover lozad" data-src="https://img-blog.csdnimg.cn/5d6a08e1d7664a98b228b1721524c94b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Previous Post</div><div class="prev_info"><span>Debian 系统解决中文乱码问题</span></div></a></div><div class="next-post pull-right"><a href="/2021/12/27/CentOS-7-yum-方式安装-MySQL5-7/"><img class="next_cover lozad" data-src="https://img-blog.csdnimg.cn/6eb871ff74734f11a95217bad131f97a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>CentOS 7 yum 方式安装 MySQL5.7</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span>Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2021/12/27/使用-node-media-server-搭建流媒体服务器/" title="使用 node-media-server 搭建流媒体服务器"><img class="relatedPosts_cover lozad" data-src="https://img-blog.csdnimg.cn/4a60c749c2af486aac62121f3715ae96.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16"><div class="relatedPosts_title">使用 node-media-server 搭建流媒体服务器</div></a></div><div class="relatedPosts_item"><a href="/2021/12/27/CentOS-7-yum-方式安装-MySQL5-7/" title="CentOS 7 yum 方式安装 MySQL5.7"><img class="relatedPosts_cover lozad" data-src="https://img-blog.csdnimg.cn/6eb871ff74734f11a95217bad131f97a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16"><div class="relatedPosts_title">CentOS 7 yum 方式安装 MySQL5.7</div></a></div><div class="relatedPosts_item"><a href="/2021/12/27/canal-实现-MySQL-实时同步数据到-ES/" title="canal 实现 MySQL 实时同步数据到 ES"><img class="relatedPosts_cover lozad" data-src="https://img-blog.csdnimg.cn/img_convert/7af03f662745af0662324eb24be4f170.png"><div class="relatedPosts_title">canal 实现 MySQL 实时同步数据到 ES</div></a></div><div class="relatedPosts_item"><a href="/2021/12/25/Docker-可视化管理工具之-Portainer/" title="Docker 可视化管理工具之 Portainer"><img class="relatedPosts_cover lozad" data-src="https://img-blog.csdnimg.cn/26f5f4840a3c4430bc438e7042d24018.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16"><div class="relatedPosts_title">Docker 可视化管理工具之 Portainer</div></a></div><div class="relatedPosts_item"><a href="/2021/12/25/Docker-容器跨主机通信-之-Swarm-方式/" title="Docker 容器跨主机通信 之 Swarm 方式"><img class="relatedPosts_cover lozad" data-src="https://img-blog.csdnimg.cn/069c76503afa4194a173fd940a36a47c.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16"><div class="relatedPosts_title">Docker 容器跨主机通信 之 Swarm 方式</div></a></div><div class="relatedPosts_item"><a href="/2021/12/25/Docker-容器跨主机通信之直接路由方式/" title="Docker 容器跨主机通信之直接路由方式"><img class="relatedPosts_cover lozad" data-src="https://img-blog.csdnimg.cn/e7cc794cb709447bbb8f22aa8f76d88e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16"><div class="relatedPosts_title">Docker 容器跨主机通信之直接路由方式</div></a></div></div><div class="clear_both"></div></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2021 By RenChing Doe</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://renqingsangbu.github.io/">blog</a>!</div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-book" id="readmode" title="Read Mode"> </i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion">繁</a><i class="fa fa-moon-o nightshift" id="nightshift" title="Dark Mode"></i></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="/js/nightshift.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zindex="-1" data-click="false"></script><script src="/js/activate-power-mode.js"></script><script>POWERMODE.colorful = true; // make power mode colorful
POWERMODE.shake = true; // turn off shake
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script></body></html>