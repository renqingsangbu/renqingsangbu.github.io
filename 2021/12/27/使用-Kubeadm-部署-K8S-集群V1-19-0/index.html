<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>使用 Kubeadm 部署 K8S 集群V1.19.0 | RenChing</title><meta name="description" content="使用 Kubeadm 部署 K8S 集群V1.19.0"><meta name="keywords" content="K8S,Kubernetes,Kubeadm"><meta name="author" content="RenChing Doe"><meta name="copyright" content="RenChing Doe"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://yoursite.com/2021/12/27/使用-Kubeadm-部署-K8S-集群V1-19-0/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="使用 Kubeadm 部署 K8S 集群V1.19.0"><meta name="twitter:description" content="使用 Kubeadm 部署 K8S 集群V1.19.0"><meta name="twitter:image" content="https://img-blog.csdnimg.cn/20feb42be5de43f9852c21ab4a0ef25a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16"><meta property="og:type" content="article"><meta property="og:title" content="使用 Kubeadm 部署 K8S 集群V1.19.0"><meta property="og:url" content="http://yoursite.com/2021/12/27/使用-Kubeadm-部署-K8S-集群V1-19-0/"><meta property="og:site_name" content="RenChing"><meta property="og:description" content="使用 Kubeadm 部署 K8S 集群V1.19.0"><meta property="og:image" content="https://img-blog.csdnimg.cn/20feb42be5de43f9852c21ab4a0ef25a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="使用二进制部署 K8S 单 Master 集群V1.20" href="http://yoursite.com/2021/12/27/使用二进制部署-K8S-单-Master-集群V1-20/"><link rel="next" title="采用 shc 工具加密 Shell 脚本" href="http://yoursite.com/2021/12/27/采用-shc-工具加密-Shell-脚本/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://renqingsangbu.github.io","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Bookmark',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days'

  
}</script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#使用-Kubeadm-部署-K8S-集群-V1-19-0"><span class="toc-text">使用 Kubeadm 部署 K8S 集群 V1.19.0</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#官方提供的几种-Kubernetes-部署方式"><span class="toc-text">官方提供的几种 Kubernetes 部署方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#minikube"><span class="toc-text">minikube</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kubeadm"><span class="toc-text">kubeadm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二进制包"><span class="toc-text">二进制包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#小结："><span class="toc-text">小结：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kubeadm-部署-K8S-集群"><span class="toc-text">kubeadm 部署 K8S 集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-安装要求"><span class="toc-text">1. 安装要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-部署步骤"><span class="toc-text">2. 部署步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-准备环境"><span class="toc-text">3. 准备环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-所有节点安装Docker-kubeadm-kubelet-kubectl"><span class="toc-text">4. 所有节点安装Docker/kubeadm/kubelet/kubectl</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-安装Docker"><span class="toc-text">4.1 安装Docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-添加阿里云YUM软件源"><span class="toc-text">4.2 添加阿里云YUM软件源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-安装kubeadm，kubelet和kubectl"><span class="toc-text">4.3 安装kubeadm，kubelet和kubectl</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-部署Kubernetes-Master"><span class="toc-text">5. 部署Kubernetes Master</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-安装Pod网络插件（CNI）"><span class="toc-text">6. 安装Pod网络插件（CNI）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-加入Kubernetes-Node"><span class="toc-text">7. 加入Kubernetes Node</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-查看集群节点信息"><span class="toc-text">7.1 查看集群节点信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-测试kubernetes集群"><span class="toc-text">8. 测试kubernetes集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-查看集群状态"><span class="toc-text">8.1 查看集群状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-创建-POD"><span class="toc-text">8.2 创建 POD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-验证"><span class="toc-text">8.3 验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-部署Web-UI界面-Dashboard-2-0"><span class="toc-text">9. 部署Web UI界面 Dashboard 2.0</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#V2-0-0对比V1-的优势"><span class="toc-text">V2.0.0对比V1.*的优势</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#下载官方配置文件"><span class="toc-text">下载官方配置文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#执行部署"><span class="toc-text">执行部署</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#创建管理员账户"><span class="toc-text">创建管理员账户</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#执行创建账户"><span class="toc-text">执行创建账户</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#获取管理员Token"><span class="toc-text">获取管理员Token</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#访问Web-UI"><span class="toc-text">访问Web UI</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-安装-Metrics-Server"><span class="toc-text">10. 安装 Metrics- Server</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#检查-API-Server-是否开启了-Aggregator-Routing"><span class="toc-text">检查 API Server 是否开启了 Aggregator Routing</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改-kube-apiserver-yaml-文件"><span class="toc-text">修改 kube-apiserver.yaml 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#部署-Metrics-Server"><span class="toc-text">部署 Metrics Server</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#下载-YAML-文件"><span class="toc-text">下载 YAML 文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#修改-Metrics-Server-的启动参数"><span class="toc-text">修改 Metrics Server 的启动参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#部署-Metrics-Server-1"><span class="toc-text">部署 Metrics Server</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#检查-Metrics-Server-Pod状态"><span class="toc-text">检查 Metrics Server Pod状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#手动下载-Metrics-Server-镜像"><span class="toc-text">手动下载 Metrics Server 镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#部署-Metrics-Server-2"><span class="toc-text">部署 Metrics Server</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#检查-Metrics-Server-Pod状态-1"><span class="toc-text">检查 Metrics Server Pod状态</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#检查-Metrics-Server-Service"><span class="toc-text">检查 Metrics Server Service</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#检查-Metrics-Server-是否可用"><span class="toc-text">检查 Metrics Server 是否可用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-Web-UI界面-Dashboard-配置证书"><span class="toc-text">11. Web UI界面 Dashboard 配置证书</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#证书获取方式"><span class="toc-text">证书获取方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建证书存放位置"><span class="toc-text">创建证书存放位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除-Dashboard"><span class="toc-text">删除 Dashboard</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建-Namepace"><span class="toc-text">创建 Namepace</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建-ssl-证书-secret"><span class="toc-text">创建 ssl 证书 secret</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#重新部署-Dashboard"><span class="toc-text">重新部署 Dashboard</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建-Dashboard-Admin-账户"><span class="toc-text">创建 Dashboard-Admin 账户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#获取-Dashboard-Service-IP"><span class="toc-text">获取 Dashboard Service IP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#获取管理员-Token"><span class="toc-text">获取管理员 Token</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#绑定-Hosts-文件"><span class="toc-text">绑定 Hosts 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#验证-HTTPS-访问"><span class="toc-text">验证 HTTPS 访问</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://img-blog.csdnimg.cn/20feb42be5de43f9852c21ab4a0ef25a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16)"><div id="page-header"><span class="pull-left"> <a class="blog_title" id="site-name" href="/">RenChing</a></span><div class="open toggle-menu pull-right"><div class="menu-icon-first"></div><div class="menu-icon-second"></div><div class="menu-icon-third"></div></div><span class="pull-right menus"><div class="mobile_author_icon"><img class="lozad" data-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'"><div class="mobile_author-info__description"></div></div><hr><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标籤</span></a><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title"><div class="posttitle">使用 Kubeadm 部署 K8S 集群V1.19.0</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2021-12-27<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> Updated 2021-12-27</time></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="使用-Kubeadm-部署-K8S-集群-V1-19-0"><a href="#使用-Kubeadm-部署-K8S-集群-V1-19-0" class="headerlink" title="使用 Kubeadm 部署 K8S 集群 V1.19.0"></a>使用 Kubeadm 部署 K8S 集群 V1.19.0</h1><h2 id="官方提供的几种-Kubernetes-部署方式"><a href="#官方提供的几种-Kubernetes-部署方式" class="headerlink" title="官方提供的几种 Kubernetes 部署方式"></a>官方提供的几种 Kubernetes 部署方式</h2><ul>
<li><h2 id="minikube"><a href="#minikube" class="headerlink" title="minikube"></a><strong>minikube</strong></h2></li>
</ul>
<p>Minikube是一个工具，可以在本地快速运行一个单点的Kubernetes，尝试Kubernetes或日常开发的用户使用。不能用于生产环境。</p>
<p>官方地址：<a href="https://kubernetes.io/docs/setup/minikube/" target="_blank" rel="noopener">https://kubernetes.io/docs/setup/minikube/</a></p>
<ul>
<li><h2 id="kubeadm"><a href="#kubeadm" class="headerlink" title="kubeadm"></a><strong>kubeadm</strong></h2></li>
</ul>
<p>Kubeadm也是一个工具，提供kubeadm init和kubeadm join，用于快速部署Kubernetes集群。</p>
<p>官方地址：<a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/</a></p>
<ul>
<li><h2 id="二进制包"><a href="#二进制包" class="headerlink" title="二进制包"></a><strong>二进制包</strong></h2></li>
</ul>
<p>从官方下载发行版的二进制包，手动部署每个组件，组成Kubernetes集群。</p>
<h2 id="小结："><a href="#小结：" class="headerlink" title="小结："></a><strong>小结：</strong></h2><blockquote>
<p> 生产环境中部署Kubernetes集群，只有<strong>Kubeadm</strong>和<strong>二进制</strong>包可选</p>
<p> <strong>Kubeadm：</strong>降低部署门槛，但屏蔽了很多细节，遇到问题很难排查。</p>
<p> <strong>二进制：</strong>虽然手动部署麻烦一点，但学习很多工作原理，更有利于后期维护。</p>
</blockquote>
<h2 id="kubeadm-部署-K8S-集群"><a href="#kubeadm-部署-K8S-集群" class="headerlink" title="kubeadm 部署 K8S 集群"></a>kubeadm 部署 K8S 集群</h2><p><img src="https://img-blog.csdnimg.cn/20210304155243688.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>​                                                                            <strong>Kubernetes 集群单Master架构图</strong></p>
<p>kubeadm是官方社区推出的一个用于快速部署kubernetes集群的工具。</p>
<p>这个工具能通过两条指令完成一个kubernetes集群的部署：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个 Master 节点</span><br><span class="line">$ kubeadm init</span><br><span class="line"></span><br><span class="line"># 将一个 Node 节点加入到当前集群中</span><br><span class="line">$ kubeadm join &lt;Master节点的IP和端口 &gt;</span><br></pre></td></tr></table></figure>

<h3 id="1-安装要求"><a href="#1-安装要求" class="headerlink" title="1. 安装要求"></a>1. 安装要求</h3><p>在开始之前，部署Kubernetes集群机器需要满足以下几个条件：</p>
<ul>
<li>一台或多台机器，操作系统 CentOS7.x-86_x64</li>
<li>硬件配置：2GB或更多RAM，2个CPU或更多CPU，硬盘30GB或更多</li>
<li>集群中所有机器之间网络互通</li>
<li>可以访问外网，需要拉取镜像</li>
<li>禁止swap分区</li>
</ul>
<h3 id="2-部署步骤"><a href="#2-部署步骤" class="headerlink" title="2. 部署步骤"></a>2. 部署步骤</h3><ol>
<li>在所有节点上安装Docker和kubeadm</li>
<li>部署Kubernetes Master</li>
<li>部署容器网络插件</li>
<li>部署 Kubernetes Node，将节点加入Kubernetes集群中</li>
<li>部署Dashboard Web页面，可视化查看Kubernetes资源</li>
</ol>
<h3 id="3-准备环境"><a href="#3-准备环境" class="headerlink" title="3. 准备环境"></a>3. 准备环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">同步时间</span><br><span class="line">$ ntpdate ntp1.aliyun.com</span><br><span class="line"></span><br><span class="line">关闭防火墙：</span><br><span class="line">$ systemctl stop firewalld</span><br><span class="line">$ systemctl disable firewalld</span><br><span class="line"></span><br><span class="line">关闭selinux：</span><br><span class="line">$ sed -i &apos;s/enforcing/disabled/&apos; /etc/selinux/config </span><br><span class="line">$ setenforce 0</span><br><span class="line"></span><br><span class="line">关闭swap：</span><br><span class="line">$ swapoff -a  $ 临时</span><br><span class="line">$ vim /etc/fstab  $ 永久</span><br><span class="line"></span><br><span class="line">添加主机名与IP对应关系（记得设置主机名）：</span><br><span class="line">$ cat /etc/hosts</span><br><span class="line">192.168.71.101	k8s-master</span><br><span class="line">192.168.71.102	k8s-node1</span><br><span class="line">192.168.71.103	k8s-node2</span><br><span class="line"></span><br><span class="line">将桥接的IPv4流量传递到iptables的链：</span><br><span class="line">$ cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">EOF</span><br><span class="line">$ sysctl --system</span><br></pre></td></tr></table></figure>

<h3 id="4-所有节点安装Docker-kubeadm-kubelet-kubectl"><a href="#4-所有节点安装Docker-kubeadm-kubelet-kubectl" class="headerlink" title="4. 所有节点安装Docker/kubeadm/kubelet/kubectl"></a>4. 所有节点安装Docker/kubeadm/kubelet/kubectl</h3><blockquote>
<p><strong>Kubernetes默认CRI（容器运行时）为Docker，因此先安装Docker</strong></p>
</blockquote>
<h4 id="4-1-安装Docker"><a href="#4-1-安装Docker" class="headerlink" title="4.1 安装Docker"></a>4.1 安装Docker</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"></span><br><span class="line">查看可用版本的docker-ce</span><br><span class="line">$ yum list docker-ce --showduplicates | sort -r</span><br><span class="line"></span><br><span class="line">安装指定版本</span><br><span class="line">$ yum -y install docker-ce-19.03.10 docker-ce-cli-19.03.10</span><br><span class="line">$ systemctl start docker &amp;&amp; systemctl enable docker</span><br><span class="line"></span><br><span class="line">查看docker版本</span><br><span class="line">$ docker --version</span><br><span class="line">Docker version 19.03.10, build 9424aeaee9</span><br></pre></td></tr></table></figure>

<h4 id="4-2-添加阿里云YUM软件源"><a href="#4-2-添加阿里云YUM软件源" class="headerlink" title="4.2 添加阿里云YUM软件源"></a>4.2 添加阿里云YUM软件源</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; EOF</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h4 id="4-3-安装kubeadm，kubelet和kubectl"><a href="#4-3-安装kubeadm，kubelet和kubectl" class="headerlink" title="4.3 安装kubeadm，kubelet和kubectl"></a>4.3 安装kubeadm，kubelet和kubectl</h4><blockquote>
<p><strong>由于版本更新频繁，这里指定版本号部署</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ yum install -y kubelet-1.19.0 kubeadm-1.19.0 kubectl-1.19.0</span><br><span class="line">$ systemctl enable kubelet</span><br><span class="line"></span><br><span class="line">$ rpm -qa | grep kube</span><br><span class="line">kubectl-1.19.0-0.x86_64</span><br><span class="line">kubelet-1.19.0-0.x86_64</span><br><span class="line">kubeadm-1.19.0-0.x86_64</span><br><span class="line">kubernetes-cni-0.8.7-0.x86_64</span><br></pre></td></tr></table></figure>

<h3 id="5-部署Kubernetes-Master"><a href="#5-部署Kubernetes-Master" class="headerlink" title="5. 部署Kubernetes Master"></a>5. 部署Kubernetes Master</h3><blockquote>
<p><strong>在（Master）执行</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm init \</span><br><span class="line">  --apiserver-advertise-address=192.168.71.101 \</span><br><span class="line">  --image-repository registry.aliyuncs.com/google_containers \</span><br><span class="line">  --kubernetes-version v1.19.0 \</span><br><span class="line">  --service-cidr=10.10.0.0/16 \</span><br><span class="line">  --pod-network-cidr=10.244.0.0/16 \</span><br><span class="line">  --ignore-preflight-errors=all</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注：复制保留以下显示的信息（后面用于Node加入集群）</strong></p>
<p>kubeadm join 192.168.71.101:6443 –token tlxpth.mlh54wv1d4h34a1z <br> –discovery-token-ca-cert-hash sha256:1eeca5c1dc62e1fb53a8dd4efde5e958246f844569680ad763196be356a6e83a</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210304105910777.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p><strong>创建存放配置文件目录</strong></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure>

<h3 id="6-安装Pod网络插件（CNI）"><a href="#6-安装Pod网络插件（CNI）" class="headerlink" title="6. 安装Pod网络插件（CNI）"></a>6. 安装Pod网络插件（CNI）</h3><blockquote>
<p><strong>创建 kube-flannel.yml 文件</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; kube-flannel.yml &lt;&lt; EOF</span><br><span class="line">---</span><br><span class="line">apiVersion: policy/v1beta1</span><br><span class="line">kind: PodSecurityPolicy</span><br><span class="line">metadata:</span><br><span class="line">  name: psp.flannel.unprivileged</span><br><span class="line">  annotations:</span><br><span class="line">    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default</span><br><span class="line">    seccomp.security.alpha.kubernetes.io/defaultProfileName: docker/default</span><br><span class="line">    apparmor.security.beta.kubernetes.io/allowedProfileNames: runtime/default</span><br><span class="line">    apparmor.security.beta.kubernetes.io/defaultProfileName: runtime/default</span><br><span class="line">spec:</span><br><span class="line">  privileged: false</span><br><span class="line">  volumes:</span><br><span class="line">  - configMap</span><br><span class="line">  - secret</span><br><span class="line">  - emptyDir</span><br><span class="line">  - hostPath</span><br><span class="line">  allowedHostPaths:</span><br><span class="line">  - pathPrefix: &quot;/etc/cni/net.d&quot;</span><br><span class="line">  - pathPrefix: &quot;/etc/kube-flannel&quot;</span><br><span class="line">  - pathPrefix: &quot;/run/flannel&quot;</span><br><span class="line">  readOnlyRootFilesystem: false</span><br><span class="line">  # Users and groups</span><br><span class="line">  runAsUser:</span><br><span class="line">    rule: RunAsAny</span><br><span class="line">  supplementalGroups:</span><br><span class="line">    rule: RunAsAny</span><br><span class="line">  fsGroup:</span><br><span class="line">    rule: RunAsAny</span><br><span class="line">  # Privilege Escalation</span><br><span class="line">  allowPrivilegeEscalation: false</span><br><span class="line">  defaultAllowPrivilegeEscalation: false</span><br><span class="line">  # Capabilities</span><br><span class="line">  allowedCapabilities: [&apos;NET_ADMIN&apos;, &apos;NET_RAW&apos;]</span><br><span class="line">  defaultAddCapabilities: []</span><br><span class="line">  requiredDropCapabilities: []</span><br><span class="line">  # Host namespaces</span><br><span class="line">  hostPID: false</span><br><span class="line">  hostIPC: false</span><br><span class="line">  hostNetwork: true</span><br><span class="line">  hostPorts:</span><br><span class="line">  - min: 0</span><br><span class="line">    max: 65535</span><br><span class="line">  # SELinux</span><br><span class="line">  seLinux:</span><br><span class="line">    # SELinux is unused in CaaSP</span><br><span class="line">    rule: &apos;RunAsAny&apos;</span><br><span class="line">---</span><br><span class="line">kind: ClusterRole</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: flannel</span><br><span class="line">rules:</span><br><span class="line">- apiGroups: [&apos;extensions&apos;]</span><br><span class="line">  resources: [&apos;podsecuritypolicies&apos;]</span><br><span class="line">  verbs: [&apos;use&apos;]</span><br><span class="line">  resourceNames: [&apos;psp.flannel.unprivileged&apos;]</span><br><span class="line">- apiGroups:</span><br><span class="line">  - &quot;&quot;</span><br><span class="line">  resources:</span><br><span class="line">  - pods</span><br><span class="line">  verbs:</span><br><span class="line">  - get</span><br><span class="line">- apiGroups:</span><br><span class="line">  - &quot;&quot;</span><br><span class="line">  resources:</span><br><span class="line">  - nodes</span><br><span class="line">  verbs:</span><br><span class="line">  - list</span><br><span class="line">  - watch</span><br><span class="line">- apiGroups:</span><br><span class="line">  - &quot;&quot;</span><br><span class="line">  resources:</span><br><span class="line">  - nodes/status</span><br><span class="line">  verbs:</span><br><span class="line">  - patch</span><br><span class="line">---</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">metadata:</span><br><span class="line">  name: flannel</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: flannel</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: flannel</span><br><span class="line">  namespace: kube-system</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: flannel</span><br><span class="line">  namespace: kube-system</span><br><span class="line">---</span><br><span class="line">kind: ConfigMap</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-flannel-cfg</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  labels:</span><br><span class="line">    tier: node</span><br><span class="line">    app: flannel</span><br><span class="line">data:</span><br><span class="line">  cni-conf.json: |</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;name&quot;: &quot;cbr0&quot;,</span><br><span class="line">      &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span><br><span class="line">      &quot;plugins&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;type&quot;: &quot;flannel&quot;,</span><br><span class="line">          &quot;delegate&quot;: &#123;</span><br><span class="line">            &quot;hairpinMode&quot;: true,</span><br><span class="line">            &quot;isDefaultGateway&quot;: true</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;type&quot;: &quot;portmap&quot;,</span><br><span class="line">          &quot;capabilities&quot;: &#123;</span><br><span class="line">            &quot;portMappings&quot;: true</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  net-conf.json: |</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;Network&quot;: &quot;10.244.0.0/16&quot;,</span><br><span class="line">      &quot;Backend&quot;: &#123;</span><br><span class="line">        &quot;Type&quot;: &quot;vxlan&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: DaemonSet</span><br><span class="line">metadata:</span><br><span class="line">  name: kube-flannel-ds</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  labels:</span><br><span class="line">    tier: node</span><br><span class="line">    app: flannel</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: flannel</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        tier: node</span><br><span class="line">        app: flannel</span><br><span class="line">    spec:</span><br><span class="line">      affinity:</span><br><span class="line">        nodeAffinity:</span><br><span class="line">          requiredDuringSchedulingIgnoredDuringExecution:</span><br><span class="line">            nodeSelectorTerms:</span><br><span class="line">            - matchExpressions:</span><br><span class="line">              - key: kubernetes.io/os</span><br><span class="line">                operator: In</span><br><span class="line">                values:</span><br><span class="line">                - linux</span><br><span class="line">      hostNetwork: true</span><br><span class="line">      priorityClassName: system-node-critical</span><br><span class="line">      tolerations:</span><br><span class="line">      - operator: Exists</span><br><span class="line">        effect: NoSchedule</span><br><span class="line">      serviceAccountName: flannel</span><br><span class="line">      initContainers:</span><br><span class="line">      - name: install-cni</span><br><span class="line">        image: quay.io/coreos/flannel:v0.13.1-rc2</span><br><span class="line">        command:</span><br><span class="line">        - cp</span><br><span class="line">        args:</span><br><span class="line">        - -f</span><br><span class="line">        - /etc/kube-flannel/cni-conf.json</span><br><span class="line">        - /etc/cni/net.d/10-flannel.conflist</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: cni</span><br><span class="line">          mountPath: /etc/cni/net.d</span><br><span class="line">        - name: flannel-cfg</span><br><span class="line">          mountPath: /etc/kube-flannel/</span><br><span class="line">      containers:</span><br><span class="line">      - name: kube-flannel</span><br><span class="line">        image: quay.io/coreos/flannel:v0.13.1-rc2</span><br><span class="line">        command:</span><br><span class="line">        - /opt/bin/flanneld</span><br><span class="line">        args:</span><br><span class="line">        - --ip-masq</span><br><span class="line">        - --kube-subnet-mgr</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            cpu: &quot;100m&quot;</span><br><span class="line">            memory: &quot;50Mi&quot;</span><br><span class="line">          limits:</span><br><span class="line">            cpu: &quot;100m&quot;</span><br><span class="line">            memory: &quot;50Mi&quot;</span><br><span class="line">        securityContext:</span><br><span class="line">          privileged: false</span><br><span class="line">          capabilities:</span><br><span class="line">            add: [&quot;NET_ADMIN&quot;, &quot;NET_RAW&quot;]</span><br><span class="line">        env:</span><br><span class="line">        - name: POD_NAME</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: metadata.name</span><br><span class="line">        - name: POD_NAMESPACE</span><br><span class="line">          valueFrom:</span><br><span class="line">            fieldRef:</span><br><span class="line">              fieldPath: metadata.namespace</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: run</span><br><span class="line">          mountPath: /run/flannel</span><br><span class="line">        - name: flannel-cfg</span><br><span class="line">          mountPath: /etc/kube-flannel/</span><br><span class="line">      volumes:</span><br><span class="line">      - name: run</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /run/flannel</span><br><span class="line">      - name: cni</span><br><span class="line">        hostPath:</span><br><span class="line">          path: /etc/cni/net.d</span><br><span class="line">      - name: flannel-cfg</span><br><span class="line">        configMap:</span><br><span class="line">          name: kube-flannel-cfg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>确保能够访问到quay.io这个registery</strong></p>
</blockquote>
<p><strong>执行以下命令创建f lannel 网络</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f kube-flannel.yml</span><br><span class="line"></span><br><span class="line">$ kubectl get pod -n kube-system | grep flannel</span><br><span class="line">kube-flannel-ds-vw65t                1/1     Running   0          2s</span><br><span class="line"></span><br><span class="line">$  kubectl get nodes </span><br><span class="line">NAME         STATUS   ROLES    AGE     VERSION</span><br><span class="line">k8s-master   Ready    master   4m59s   v1.19.0</span><br></pre></td></tr></table></figure>

<h3 id="7-加入Kubernetes-Node"><a href="#7-加入Kubernetes-Node" class="headerlink" title="7. 加入Kubernetes Node"></a>7. 加入Kubernetes Node</h3><blockquote>
<p><strong>向集群添加新节点，执行在kubeadm init输出的kubeadm join命令</strong></p>
</blockquote>
<blockquote>
<p><strong>在（Node）执行（注：以下命令是在master节点上执行kubeadm init后生成的）</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubeadm join 192.168.71.101:6443 --token tlxpth.mlh54wv1d4h34a1z \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:1eeca5c1dc62e1fb53a8dd4efde5e958246f844569680ad763196be356a6e83a</span><br></pre></td></tr></table></figure>

<h4 id="7-1-查看集群节点信息"><a href="#7-1-查看集群节点信息" class="headerlink" title="7.1 查看集群节点信息"></a>7.1 查看集群节点信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get nodes </span><br><span class="line">NAME         STATUS   ROLES    AGE   VERSION</span><br><span class="line">k8s-master   Ready    master   6m55s   v1.19.0</span><br><span class="line">k8s-node1    Ready    &lt;none&gt;   57s     v1.19.0</span><br><span class="line">k8s-node2    Ready    &lt;none&gt;   56s     v1.19.0</span><br></pre></td></tr></table></figure>

<h3 id="8-测试kubernetes集群"><a href="#8-测试kubernetes集群" class="headerlink" title="8. 测试kubernetes集群"></a>8. 测试kubernetes集群</h3><h4 id="8-1-查看集群状态"><a href="#8-1-查看集群状态" class="headerlink" title="8.1 查看集群状态"></a>8.1 查看集群状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get cs</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>如果报 cs 接口错误，按照以下解决方法处理</strong></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210329111749704.png" alt="在这里插入图片描述"></p>
<blockquote>
<p><strong>修改 master 节点配置文件，修改 manifests 配置后会 kubelet 会自动重启生效**</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/kubernetes/manifests/kube-controller-manager.yaml</span><br><span class="line">$ vim /etc/kubernetes/manifests/kube-scheduler.yaml</span><br><span class="line"></span><br><span class="line">注释掉以下行 </span><br><span class="line">- --port=0</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>再次查看集群状态</strong></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210329112609440.png" alt="在这里插入图片描述"></p>
<h4 id="8-2-创建-POD"><a href="#8-2-创建-POD" class="headerlink" title="8.2 创建 POD"></a>8.2 创建 POD</h4><p><strong>在Kubernetes集群中创建一个pod，验证是否正常运行：</strong></p>
<blockquote>
<p><strong>创建无状态应用</strong><br><strong>暴露80端口 svc类型为 NodePort</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create deployment nginx --image=nginx</span><br><span class="line"></span><br><span class="line">$ kubectl expose deployment nginx --port=80 --type=NodePort</span><br><span class="line"></span><br><span class="line">$ kubectl get pod,svc</span><br><span class="line">AME                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/nginx-6799fc88d8-jz4js   1/1    Running   0          15s</span><br><span class="line"></span><br><span class="line">NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">service/kubernetes   ClusterIP   10.10.0.1       &lt;none&gt;        443/TCP        7m43s</span><br><span class="line">service/nginx        NodePort    10.10.254.254   &lt;none&gt;        80:32750/TCP   8s</span><br></pre></td></tr></table></figure>

<h4 id="8-3-验证"><a href="#8-3-验证" class="headerlink" title="8.3 验证"></a>8.3 验证</h4><blockquote>
<p><strong>访问地址：<a href="http://192.168.71.102:32750" target="_blank" rel="noopener">http://192.168.71.102:32750</a></strong>  </p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210327151255413.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="9-部署Web-UI界面-Dashboard-2-0"><a href="#9-部署Web-UI界面-Dashboard-2-0" class="headerlink" title="9. 部署Web UI界面 Dashboard 2.0"></a>9. 部署Web UI界面 Dashboard 2.0</h3><h4 id="V2-0-0对比V1-的优势"><a href="#V2-0-0对比V1-的优势" class="headerlink" title="V2.0.0对比V1.*的优势"></a>V2.0.0对比V1.*的优势</h4><ul>
<li>监控信息不需要通过Heapster来提供，而是通过Metrics Server来提供，Metrics Scraper服务来采集，不需要单独维护Heapster</li>
<li>支持暗黑主题</li>
<li>监控图显示更细节化</li>
<li>编辑支持yaml和json</li>
</ul>
<h5 id="下载官方配置文件"><a href="#下载官方配置文件" class="headerlink" title="下载官方配置文件"></a>下载官方配置文件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ wget -O dashboard.yaml https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-rc1/aio/deploy/recommended.yaml</span><br><span class="line"></span><br><span class="line">$ vim dashboard.yaml</span><br><span class="line">修改以下配置</span><br><span class="line"></span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">  name: kubernetes-dashboard</span><br><span class="line">  namespace: kubernetes-dashboard</span><br><span class="line">spec:</span><br><span class="line">  <span class="built_in">type</span>: NodePort		执行类型为 NodePort</span><br><span class="line">  ports:</span><br><span class="line">    - port: 443</span><br><span class="line">      targetPort: 8443</span><br><span class="line">      nodePort: 32132	暴露端口为 32132</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br></pre></td></tr></table></figure>

<h5 id="执行部署"><a href="#执行部署" class="headerlink" title="执行部署"></a>执行部署</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f dashboard.yaml</span><br></pre></td></tr></table></figure>

<h5 id="创建管理员账户"><a href="#创建管理员账户" class="headerlink" title="创建管理员账户"></a>创建管理员账户</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ cat &gt; dashboard-admin.yaml &lt;&lt;EOF </span><br><span class="line">apiVersion: v1 </span><br><span class="line">kind: ServiceAccount </span><br><span class="line">metadata: </span><br><span class="line">  labels: </span><br><span class="line">    k8s-app: kubernetes-dashboard </span><br><span class="line">  name: dashboard-admin </span><br><span class="line">  namespace: kubernetes-dashboard </span><br><span class="line">--- </span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1 </span><br><span class="line">kind: ClusterRoleBinding </span><br><span class="line">metadata: </span><br><span class="line">  name: dashboard-admin-bind-cluster-role </span><br><span class="line">  labels: </span><br><span class="line">    k8s-app: kubernetes-dashboard </span><br><span class="line">roleRef: </span><br><span class="line">  apiGroup: rbac.authorization.k8s.io </span><br><span class="line">  kind: ClusterRole </span><br><span class="line">  name: cluster-admin </span><br><span class="line">subjects: </span><br><span class="line">- kind: ServiceAccount </span><br><span class="line">  name: dashboard-admin </span><br><span class="line">  namespace: kubernetes-dashboard </span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h5 id="执行创建账户"><a href="#执行创建账户" class="headerlink" title="执行创建账户"></a>执行创建账户</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f dashboard-admin.yaml</span><br></pre></td></tr></table></figure>

<h5 id="获取管理员Token"><a href="#获取管理员Token" class="headerlink" title="获取管理员Token"></a>获取管理员Token</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard <span class="keyword">get</span> secret | grep dashboard-admin | awk '&#123;print $<span class="number">1</span>&#125;<span class="string">')</span></span><br><span class="line"><span class="string">Name:         dashboard-admin-token-vtvnv</span></span><br><span class="line"><span class="string">Namespace:    kubernetes-dashboard</span></span><br><span class="line"><span class="string">Labels:       &lt;none&gt;</span></span><br><span class="line"><span class="string">Annotations:  kubernetes.io/service-account.name: dashboard-admin</span></span><br><span class="line"><span class="string">              kubernetes.io/service-account.uid: 30de90c2-0056-4652-9618-b74b62903f61</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Type:  kubernetes.io/service-account-token</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Data</span></span><br><span class="line"><span class="string">====</span></span><br><span class="line"><span class="string">ca.crt:     1066 bytes</span></span><br><span class="line"><span class="string">namespace:  20 bytes</span></span><br><span class="line"><span class="string">token:      eyJhbGciOiJSUzI1NiIsImtpZCI6Im9sV2ZqZnNEbmdKU2dlaUNDSnBhR1gzT0ZJanFaVWFCaDhWS0pDTTYtRzQifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tdnR2bnYiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMzBkZTkwYzItMDA1Ni00NjUyLTk2MTgtYjc0YjYyOTAzZjYxIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.sa7ALRL6XAU7tUrX-Kdfub5CY_K1CVE4XnKZ-GtLOQT4BKKg2dEm2N5guumFICgyePjhFBUktcIxun4XJwYArT5XeqCQemfwrAc87BA9PKZeD5QdlaH_AgFqLukSs2--NpkHcNbZrG_hYXO_KC3yDHWSiGKfR8zZ--ZplbjbMPaA7R67MNCwY19fe-jgOGPbxMYiuFrY6NdRVfLS3pRmiNy_lI_3pWy74t-NTylSKodBVOc2BDgbK7tZROkdoas2mDTIBFXXpLxagB0bXR-5ofbYtnNVmAPzOr9y6eE1Yd0o8IuBGBiDvyfGQ0SozTGET71rS3hy6U46TN5zEPYU1Q</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>上面最后一行的token就是我们登陆dashboard需要的token</strong></p>
</blockquote>
<blockquote>
<p><strong>查看dashboard service地址</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get svc -n kubernetes-dashboard</span><br><span class="line">NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE</span><br><span class="line">dashboard-metrics-scraper   ClusterIP   10.10.43.235    &lt;none&gt;        8000/TCP        4m17s</span><br><span class="line">kubernetes-dashboard        NodePort    10.10.136.217   &lt;none&gt;        443:32132/TCP   4m17s</span><br></pre></td></tr></table></figure>

<h5 id="访问Web-UI"><a href="#访问Web-UI" class="headerlink" title="访问Web UI"></a>访问Web UI</h5><blockquote>
<p><strong>直接在浏览器中输入<a href="https://NodeIP:32132" target="_blank" rel="noopener">https://NodeIP:32132</a></strong></p>
<p><strong>再输入上面获取的token即可进入dashboard（此处还没有配置证书）</strong></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210327155902748.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p>*<em>Chrome如果提示以上错误，在Chrome该页面上，直接键盘敲入这11个字符：<code>thisisunsafe</code> *</em></p>
<p><strong>（鼠标点击当前页面任意位置，让页面处于最上层即可输入）</strong></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210327160146360.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p><strong>输入获取的到的token登录</strong></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210327160242246.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20210327160400805.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p><strong>上面信息中可以看到CPU和内存信息都还没有显示，是因为没有安装metrics-server</strong></p>
</blockquote>
<h3 id="10-安装-Metrics-Server"><a href="#10-安装-Metrics-Server" class="headerlink" title="10. 安装 Metrics- Server"></a>10. 安装 Metrics- Server</h3><h4 id="检查-API-Server-是否开启了-Aggregator-Routing"><a href="#检查-API-Server-是否开启了-Aggregator-Routing" class="headerlink" title="检查 API Server 是否开启了 Aggregator Routing"></a>检查 API Server 是否开启了 Aggregator Routing</h4><blockquote>
<p><strong>查看 API Server 是否具有 –enable-aggregator-routing=true 选项</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | grep apiserver</span><br><span class="line">root       8873   8791  2 15:03 ?        00:02:03 kube-apiserver --advertise-address=192.168.71.101 --allow-privileged=true --authorization-mode=Node,RBAC --client-ca-file=/etc/kubernetes/pki/ca.crt --enable-admission-plugins=NodeRestriction --enable-bootstrap-token-auth=true --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-client-certificate=/etc/kubernetes/pki/apiserver-kubelet-client.crt --kubelet-client-key=/etc/kubernetes/pki/apiserver-kubelet-client.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.crt --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client.key --requestheader-allowed-names=front-proxy-client --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-key-file=/etc/kubernetes/pki/sa.pub --service-cluster-ip-range=10.10.0.0/16 --tls-cert-file=/etc/kubernetes/pki/apiserver.crt --tls-private-key-file=/etc/kubernetes/pki/apiserver.key</span><br></pre></td></tr></table></figure>

<h4 id="修改-kube-apiserver-yaml-文件"><a href="#修改-kube-apiserver-yaml-文件" class="headerlink" title="修改 kube-apiserver.yaml 文件"></a>修改 kube-apiserver.yaml 文件</h4><blockquote>
<p><strong>修改 API Server 的 kube-apiserver.yaml 配置开启 Aggregator Routing</strong></p>
<p><strong>修改 manifests 配置后会 API Server 会自动重启生效</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/kubernetes/manifests/kube-apiserver.yaml</span><br><span class="line">...</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - command:</span><br><span class="line">...</span><br><span class="line">  - --enable-aggregator-routing=true		添加此行</span><br></pre></td></tr></table></figure>

<h4 id="部署-Metrics-Server"><a href="#部署-Metrics-Server" class="headerlink" title="部署 Metrics Server"></a>部署 Metrics Server</h4><h5 id="下载-YAML-文件"><a href="#下载-YAML-文件" class="headerlink" title="下载 YAML 文件"></a>下载 YAML 文件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget -O metrics-server.yaml https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.4.1/components.yaml</span><br></pre></td></tr></table></figure>

<h5 id="修改-Metrics-Server-的启动参数"><a href="#修改-Metrics-Server-的启动参数" class="headerlink" title="修改 Metrics Server 的启动参数"></a>修改 Metrics Server 的启动参数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ vim components.yaml</span><br><span class="line"></span><br><span class="line">#  --kubelet-insecure-tls 跳过 TLS 认证，否则会出现 x509 的认证问题，用于测试环境。</span><br><span class="line">#  --kubelet-preferred-address-types=InternalIP 使用 Node IP 进行通信。</span><br><span class="line">      - args:</span><br><span class="line">        - --cert-dir=/tmp</span><br><span class="line">        - --secure-port=4443</span><br><span class="line">        - --kubelet-preferred-address-types=InternalIP</span><br><span class="line">        - --kubelet-use-node-status-port</span><br><span class="line">        - --kubelet-insecure-tls</span><br></pre></td></tr></table></figure>

<h5 id="部署-Metrics-Server-1"><a href="#部署-Metrics-Server-1" class="headerlink" title="部署 Metrics Server"></a>部署 Metrics Server</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f metrics-server.yaml</span><br><span class="line">serviceaccount/metrics-server created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/system:metrics-server created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator created</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/system:metrics-server created</span><br><span class="line">service/metrics-server created</span><br><span class="line">deployment.apps/metrics-server created</span><br><span class="line">apiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created</span><br></pre></td></tr></table></figure>

<h5 id="检查-Metrics-Server-Pod状态"><a href="#检查-Metrics-Server-Pod状态" class="headerlink" title="检查 Metrics Server Pod状态"></a>检查 Metrics Server Pod状态</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod -n kube-system | grep metrics-server</span><br><span class="line">metrics-server-bfcc967d6-czfbg       0/1     ImagePullBackOff   0          20m</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意：如果出现了 ErrImagePull 的问题，那么意味着 k8s.gcr.io/metrics-server/metrics-server:v0.4.1 镜像下载失败</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull k8s.gcr.io/metrics-server/metrics-server:v0.4.1</span><br><span class="line">Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)</span><br></pre></td></tr></table></figure>

<h5 id="手动下载-Metrics-Server-镜像"><a href="#手动下载-Metrics-Server-镜像" class="headerlink" title="手动下载 Metrics Server 镜像"></a>手动下载 Metrics Server 镜像</h5><blockquote>
<p><strong>这时候就需要我们在每个节点上都手动下载镜像</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull bitnami/metrics-server:0.4.1</span><br><span class="line"></span><br><span class="line">$ docker tag bitnami/metrics-server:0.4.1 k8s.gcr.io/metrics-server/metrics-server:v0.4.1</span><br><span class="line"></span><br><span class="line">$ docker images | grep metrics-server</span><br><span class="line">bitnami/metrics-server                                            0.4.1               e996b9ba65f9        7 weeks ago         171MB</span><br><span class="line">k8s.gcr.io/metrics-server/metrics-server                          v0.4.1              e996b9ba65f9        7 weeks ago         171MB</span><br></pre></td></tr></table></figure>

<h5 id="部署-Metrics-Server-2"><a href="#部署-Metrics-Server-2" class="headerlink" title="部署 Metrics Server"></a>部署 Metrics Server</h5><blockquote>
<p><strong>然后再次执行 Metrics Server 的部署指令</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f metrics-server.yaml</span><br></pre></td></tr></table></figure>

<h5 id="检查-Metrics-Server-Pod状态-1"><a href="#检查-Metrics-Server-Pod状态-1" class="headerlink" title="检查 Metrics Server Pod状态"></a>检查 Metrics Server Pod状态</h5><blockquote>
<p><strong>以下看到是 Running，那么意味着 metrics-server pod 状态为运行状态</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod -n kube-system | grep metrics-server</span><br><span class="line">metrics-server-bfcc967d6-czfbg       1/1     Running   0          26m</span><br></pre></td></tr></table></figure>

<h5 id="检查-Metrics-Server-Service"><a href="#检查-Metrics-Server-Service" class="headerlink" title="检查 Metrics Server Service"></a>检查 Metrics Server Service</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get svc --all-namespaces | grep metrics-server</span><br><span class="line">kube-system            metrics-server              ClusterIP   10.10.77.65     &lt;none&gt;        443/TCP                  29m</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>检查 API Server 是否可以连通 Metrics Server</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe svc metrics-server -n kube-system</span><br><span class="line">Name:              metrics-server</span><br><span class="line">Namespace:         kube-system</span><br><span class="line">Labels:            k8s-app=metrics-server</span><br><span class="line">Annotations:       &lt;none&gt;</span><br><span class="line">Selector:          k8s-app=metrics-server</span><br><span class="line">Type:              ClusterIP</span><br><span class="line">IP:                10.10.77.65</span><br><span class="line">Port:              https  443/TCP</span><br><span class="line">TargetPort:        https/TCP</span><br><span class="line">Endpoints:         10.244.2.3:4443</span><br><span class="line">Session Affinity:  None</span><br><span class="line">Events:            &lt;none&gt;</span><br></pre></td></tr></table></figure>

<h5 id="检查-Metrics-Server-是否可用"><a href="#检查-Metrics-Server-是否可用" class="headerlink" title="检查 Metrics Server 是否可用"></a>检查 Metrics Server 是否可用</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl top nodes</span><br><span class="line">NAME         CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%   </span><br><span class="line">k8s-master   76m          3%     1046Mi          60%       </span><br><span class="line">k8s-node1    20m          1%     737Mi           42%       </span><br><span class="line">k8s-node2    20m          1%     712Mi           41%</span><br></pre></td></tr></table></figure>

<p>*<em>浏览器访问 <a href="https://NodeIP:32132" target="_blank" rel="noopener">https://NodeIP:32132</a> *</em></p>
<blockquote>
<p><strong>现在可以看到CPU和内存信息</strong></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/2021032717011021.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p><strong>至此Metrics Server部署完成了</strong></p>
</blockquote>
<h3 id="11-Web-UI界面-Dashboard-配置证书"><a href="#11-Web-UI界面-Dashboard-配置证书" class="headerlink" title="11. Web UI界面 Dashboard 配置证书"></a>11. Web UI界面 Dashboard 配置证书</h3><h4 id="证书获取方式"><a href="#证书获取方式" class="headerlink" title="证书获取方式"></a>证书获取方式</h4><ol>
<li>可以通过阿里云申请1年免费证书</li>
<li>通过 <a href="https://freessl.cn" target="_blank" rel="noopener">https://freessl.cn</a> 网站，在线生成免费1年的证书</li>
<li>通过 Let’s Encrypt 生成 90天 免费证书</li>
<li>通过 Cert-Manager 服务来生成和管理证书</li>
</ol>
<h4 id="创建证书存放位置"><a href="#创建证书存放位置" class="headerlink" title="创建证书存放位置"></a>创建证书存放位置</h4><blockquote>
<p><strong>免费证书存放在 $HOME/certs 目录下，取名为tls.crt和tls.key</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir $HOME/certs</span><br><span class="line"></span><br><span class="line">$ ll certs/</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r-- 1 root root 3672 Mar 27 13:58 tls.crt</span><br><span class="line">-rw-r--r-- 1 root root 1675 Mar 27 13:58 tls.key</span><br></pre></td></tr></table></figure>

<h4 id="删除-Dashboard"><a href="#删除-Dashboard" class="headerlink" title="删除 Dashboard"></a>删除 Dashboard</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl delete -f dashboard.yaml</span><br></pre></td></tr></table></figure>

<h4 id="创建-Namepace"><a href="#创建-Namepace" class="headerlink" title="创建 Namepace"></a>创建 Namepace</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create namespace kubernetes-dashboard</span><br></pre></td></tr></table></figure>

<h4 id="创建-ssl-证书-secret"><a href="#创建-ssl-证书-secret" class="headerlink" title="创建 ssl 证书 secret"></a>创建 ssl 证书 secret</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create secret generic kubernetes-dashboard-certs --from-file=<span class="variable">$HOME</span>/certs -n kubernetes-dashboard</span><br></pre></td></tr></table></figure>

<h4 id="重新部署-Dashboard"><a href="#重新部署-Dashboard" class="headerlink" title="重新部署 Dashboard"></a>重新部署 Dashboard</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f dashboard.yaml</span><br></pre></td></tr></table></figure>

<h4 id="创建-Dashboard-Admin-账户"><a href="#创建-Dashboard-Admin-账户" class="headerlink" title="创建 Dashboard-Admin 账户"></a>创建 Dashboard-Admin 账户</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f dashboard-admin.yaml</span><br></pre></td></tr></table></figure>

<h4 id="获取-Dashboard-Service-IP"><a href="#获取-Dashboard-Service-IP" class="headerlink" title="获取 Dashboard Service IP"></a>获取 Dashboard Service IP</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod,svc -n kubernetes-dashboard</span><br><span class="line">NAME                                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/dashboard-metrics-scraper-7445d59dfd-9x6l4   1/1     Running   0          2m13s</span><br><span class="line">pod/kubernetes-dashboard-8795df748-4p56q         1/1     Running   0          2m13s</span><br><span class="line"></span><br><span class="line">NAME                                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE</span><br><span class="line">service/dashboard-metrics-scraper   ClusterIP   10.10.142.184   &lt;none&gt;        8000/TCP        2m13s</span><br><span class="line">service/kubernetes-dashboard        NodePort    10.10.111.72    &lt;none&gt;        443:32132/TCP   2m13s</span><br></pre></td></tr></table></figure>

<h4 id="获取管理员-Token"><a href="#获取管理员-Token" class="headerlink" title="获取管理员 Token"></a>获取管理员 Token</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep dashboard-admin | awk &apos;&#123;print $1&#125;&apos;)</span><br><span class="line">Name:         dashboard-admin-token-nq2bh</span><br><span class="line">Namespace:    kubernetes-dashboard</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  kubernetes.io/service-account.name: dashboard-admin</span><br><span class="line">              kubernetes.io/service-account.uid: 197689f6-d597-458c-ac4c-22b5c9c39264</span><br><span class="line"></span><br><span class="line">Type:  kubernetes.io/service-account-token</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">ca.crt:     1066 bytes</span><br><span class="line">namespace:  20 bytes</span><br><span class="line">token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IlRIdlByWktudkxZZFRXaGRsNHdMOVpOSzc3OGlwSUVVSzNvZTNZRFFwb1EifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tbnEyYmgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMTk3Njg5ZjYtZDU5Ny00NThjLWFjNGMtMjJiNWM5YzM5MjY0Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.CZiM0TGifLrstmAjzpfnqtq4zK24kJjXao12tsAI8sizJ34YOqC7H_bNHEFllT-D_O-T9bFwt2wjh7HLkhtiDW_apNQuBbxrURQ_soyn3MTFIp-MNbH3e6XDmgYU4fQtfQVbGWSDXKfk4YV4axYh6bzFzrhoC6-r16ivSCxiE-2oRNc01SoIwTh04m4_GY9_5g_6x1u-b7v_9BtIFrVvbrGaf71Oz5PKfRYGTiFDiI8f4u9ofJeu1VZHdGIgj4lfIzv_WjOMD0UORPCyDgfejLQ_PGUCNWYfGuGQVw1_KsoJUppKOY3Yr3tXeR5S_9RZU0eiLM5AIl76oChGamsl_w</span><br></pre></td></tr></table></figure>

<h4 id="绑定-Hosts-文件"><a href="#绑定-Hosts-文件" class="headerlink" title="绑定 Hosts 文件"></a>绑定 Hosts 文件</h4><blockquote>
<p><strong>然后绑定一个host，然后就能通过域名访问dashboard，绑定的域名为申请证书的域名保持一致</strong></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210327225443552.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="验证-HTTPS-访问"><a href="#验证-HTTPS-访问" class="headerlink" title="验证 HTTPS 访问"></a>验证 HTTPS 访问</h4><p><img src="https://img-blog.csdnimg.cn/20210327225828940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20210327230024200.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p><strong>至此 Dashboard 证书配置完成</strong></p>
</blockquote>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">RenChing Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2021/12/27/使用-Kubeadm-部署-K8S-集群V1-19-0/">http://yoursite.com/2021/12/27/使用-Kubeadm-部署-K8S-集群V1-19-0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/K8S/">K8S    </a><a class="post-meta__tags" href="/tags/Kubernetes/">Kubernetes    </a><a class="post-meta__tags" href="/tags/Kubeadm/">Kubeadm    </a></div><div class="post_share"><div class="social-share" data-image="https://img-blog.csdnimg.cn/20feb42be5de43f9852c21ab4a0ef25a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-buttom"><i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/alipay.jpg"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2021/12/27/使用二进制部署-K8S-单-Master-集群V1-20/"><img class="prev_cover lozad" data-src="https://img-blog.csdnimg.cn/5494d8aa7bfa4b0d91b4b9a3f6388710.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Previous Post</div><div class="prev_info"><span>使用二进制部署 K8S 单 Master 集群V1.20</span></div></a></div><div class="next-post pull-right"><a href="/2021/12/27/采用-shc-工具加密-Shell-脚本/"><img class="next_cover lozad" data-src="https://img-blog.csdnimg.cn/21dc1297aa934b84b9e1e814bce10fa4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>采用 shc 工具加密 Shell 脚本</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span>Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2021/12/27/k8s-持久化存储之-StorageClass/" title="k8s 持久化存储之 StorageClass"><img class="relatedPosts_cover lozad" data-src="undefined"><div class="relatedPosts_title">k8s 持久化存储之 StorageClass</div></a></div><div class="relatedPosts_item"><a href="/2021/12/27/k8s-持久化存储之-PV-PVC/" title="k8s 持久化存储之 PV&PVC"><img class="relatedPosts_cover lozad" data-src="undefined"><div class="relatedPosts_title">k8s 持久化存储之 PV&PVC</div></a></div><div class="relatedPosts_item"><a href="/2021/12/27/k8s-持久化存储之-Volume/" title="k8s 持久化存储之 Volume"><img class="relatedPosts_cover lozad" data-src="undefined"><div class="relatedPosts_title">k8s 持久化存储之 Volume</div></a></div><div class="relatedPosts_item"><a href="/2021/12/27/k8s-服务之-HPA-自动水平伸缩-Pod/" title="k8s 服务之 HPA 自动水平伸缩 Pod"><img class="relatedPosts_cover lozad" data-src="https://img-blog.csdnimg.cn/21cd41a0255e4beabfad3ca8c5d25e03.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16"><div class="relatedPosts_title">k8s 服务之 HPA 自动水平伸缩 Pod</div></a></div><div class="relatedPosts_item"><a href="/2021/12/27/K8s-服务之-Pod-健康检测/" title="K8s 服务之 Pod 健康检测"><img class="relatedPosts_cover lozad" data-src="(https://img-blog.csdnimg.cn/cd51ed24068e4ae59be24e73f22cda5e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16"><div class="relatedPosts_title">K8s 服务之 Pod 健康检测</div></a></div><div class="relatedPosts_item"><a href="/2021/12/27/使用二进制部署-K8S-单-Master-集群V1-20/" title="使用二进制部署 K8S 单 Master 集群V1.20"><img class="relatedPosts_cover lozad" data-src="https://img-blog.csdnimg.cn/5494d8aa7bfa4b0d91b4b9a3f6388710.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16"><div class="relatedPosts_title">使用二进制部署 K8S 单 Master 集群V1.20</div></a></div></div><div class="clear_both"></div></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2021 By RenChing Doe</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://renqingsangbu.github.io/">blog</a>!</div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-book" id="readmode" title="Read Mode"> </i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion">繁</a><i class="fa fa-moon-o nightshift" id="nightshift" title="Dark Mode"></i></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="/js/nightshift.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zindex="-1" data-click="false"></script><script src="/js/activate-power-mode.js"></script><script>POWERMODE.colorful = true; // make power mode colorful
POWERMODE.shake = true; // turn off shake
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script></body></html>