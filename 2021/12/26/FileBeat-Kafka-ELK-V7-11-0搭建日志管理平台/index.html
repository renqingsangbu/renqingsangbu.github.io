<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>FileBeat+Kafka+ELK_V7.11.0搭建日志管理平台 | RenChing</title><meta name="description" content="FileBeat+Kafka+ELK_V7.11.0搭建日志管理平台"><meta name="keywords" content="ELK,Kafka"><meta name="author" content="RenChing Doe"><meta name="copyright" content="RenChing Doe"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://yoursite.com/2021/12/26/FileBeat-Kafka-ELK-V7-11-0搭建日志管理平台/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="FileBeat+Kafka+ELK_V7.11.0搭建日志管理平台"><meta name="twitter:description" content="FileBeat+Kafka+ELK_V7.11.0搭建日志管理平台"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk+filebeat+kafka.png"><meta property="og:type" content="article"><meta property="og:title" content="FileBeat+Kafka+ELK_V7.11.0搭建日志管理平台"><meta property="og:url" content="http://yoursite.com/2021/12/26/FileBeat-Kafka-ELK-V7-11-0搭建日志管理平台/"><meta property="og:site_name" content="RenChing"><meta property="og:description" content="FileBeat+Kafka+ELK_V7.11.0搭建日志管理平台"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk+filebeat+kafka.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="Elasticsearch7.x.x开启X-pack鉴权" href="http://yoursite.com/2021/12/26/Elasticsearch7-x-x开启X-pack鉴权/"><link rel="next" title="Docker 可视化管理工具之 Portainer" href="http://yoursite.com/2021/12/25/Docker-可视化管理工具之-Portainer/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://renqingsangbu.github.io","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Bookmark',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days'

  
}</script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#FileBeat-Kafka-ELK搭建日志管理平台"><span class="toc-text">FileBeat+Kafka+ELK搭建日志管理平台</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-概述"><span class="toc-text">1 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-常见部署架构"><span class="toc-text">2 常见部署架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Logstash作为日志收集器"><span class="toc-text">2.1 Logstash作为日志收集器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Filebeat作为日志收集器"><span class="toc-text">2.2 Filebeat作为日志收集器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-引入Kafka缓存队列的部署架构"><span class="toc-text">2.3 引入Kafka缓存队列的部署架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-三种架构总结"><span class="toc-text">2.4 三种架构总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-环境介绍"><span class="toc-text">3 环境介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-开始安装部署ELK"><span class="toc-text">4 开始安装部署ELK</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-部署前准备"><span class="toc-text">4.1 部署前准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-安装-jdk8"><span class="toc-text">4.2 安装 jdk8</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#解压jdk安装包"><span class="toc-text">解压jdk安装包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置java环境变量"><span class="toc-text">配置java环境变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#重载-etc-profile文件"><span class="toc-text">重载/etc/profile文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看Java版本"><span class="toc-text">查看Java版本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-安装elasticsearch"><span class="toc-text">4.3 安装elasticsearch</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建-elk-用户及相应数据目录、日志目录"><span class="toc-text">创建 elk 用户及相应数据目录、日志目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#解压源码包"><span class="toc-text">解压源码包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改-elk-属主、属组"><span class="toc-text">修改 elk 属主、属组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#elasticsearch配置文件解析"><span class="toc-text">elasticsearch配置文件解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编写elasticsearch服务启动程序"><span class="toc-text">编写elasticsearch服务启动程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-elasticsearch-服务"><span class="toc-text">启动 elasticsearch  服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#检查-elasticsearch-服务状态"><span class="toc-text">检查 elasticsearch 服务状态</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#访问验证"><span class="toc-text">访问验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#查看集群健康状态"><span class="toc-text">查看集群健康状态</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-部署-Kafka-zookeeper-集群"><span class="toc-text">4.4 部署 Kafka zookeeper 集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建zookeeper目录"><span class="toc-text">创建zookeeper目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改-zookeeper-配置文件"><span class="toc-text">修改 zookeeper 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zookeeper配置文件解析"><span class="toc-text">zookeeper配置文件解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-Zookeeper-环境变量"><span class="toc-text">配置 Zookeeper 环境变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-myid-文件"><span class="toc-text">配置 myid 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-zookeeper"><span class="toc-text">启动 zookeeper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#验证-zookeeper-节点状态"><span class="toc-text">验证 zookeeper 节点状态</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kafka-集群安装与配置"><span class="toc-text">Kafka 集群安装与配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-Kafka-配置文件"><span class="toc-text">配置 Kafka 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kafka配置文件解析"><span class="toc-text">kafka配置文件解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-Kafka-环境变量"><span class="toc-text">配置 Kafka 环境变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-Kafka-服务"><span class="toc-text">启动 Kafka 服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Filebeat收集系统日志"><span class="toc-text">Filebeat收集系统日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#系统日志文件添加权限"><span class="toc-text">系统日志文件添加权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Filebeat配置"><span class="toc-text">Filebeat配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filebeat配置文件解析"><span class="toc-text">filebeat配置文件解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编写Filebeat服务程序"><span class="toc-text">编写Filebeat服务程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-Filebeat-并设置开机自启"><span class="toc-text">启动 Filebeat 并设置开机自启</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看kafka中是否创建了topics"><span class="toc-text">查看kafka中是否创建了topics</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置启用-Logstash-读取-kafka-中数据"><span class="toc-text">配置启用 Logstash 读取 kafka 中数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#logstash配置文件解析"><span class="toc-text">logstash配置文件解析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编写logstash服务程序"><span class="toc-text">编写logstash服务程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-Logstash-并设置开机自启"><span class="toc-text">启动 Logstash 并设置开机自启</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-kibana"><span class="toc-text">配置 kibana</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编写kibana服务程序"><span class="toc-text">编写kibana服务程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-kibana-并设置开机自启"><span class="toc-text">启动 kibana 并设置开机自启</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#验证kibana"><span class="toc-text">验证kibana</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#在kibana添加索引"><span class="toc-text">在kibana添加索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kibana查看索引"><span class="toc-text">kibana查看索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#业务服务器-Filebeat收集Nginx日志"><span class="toc-text">业务服务器+Filebeat收集Nginx日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#定制nginx日志格式为json"><span class="toc-text">定制nginx日志格式为json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Filebeat配置-1"><span class="toc-text">Filebeat配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#重启-Filebeat-服务"><span class="toc-text">重启 Filebeat 服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看kafka中是否创建了topics-1"><span class="toc-text">查看kafka中是否创建了topics</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置启用-Logstash-读取-kafka-中数据-1"><span class="toc-text">配置启用 Logstash 读取 kafka 中数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#重启-Logstash-服务"><span class="toc-text">重启 Logstash 服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kibana-查看索引"><span class="toc-text">kibana 查看索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kibana-添加索引"><span class="toc-text">kibana 添加索引</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk+filebeat+kafka.png)"><div id="page-header"><span class="pull-left"> <a class="blog_title" id="site-name" href="/">RenChing</a></span><div class="open toggle-menu pull-right"><div class="menu-icon-first"></div><div class="menu-icon-second"></div><div class="menu-icon-third"></div></div><span class="pull-right menus"><div class="mobile_author_icon"><img class="lozad" data-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'"><div class="mobile_author-info__description"></div></div><hr><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标籤</span></a><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title"><div class="posttitle">FileBeat+Kafka+ELK_V7.11.0搭建日志管理平台</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2021-12-26<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> Updated 2021-12-26</time></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="FileBeat-Kafka-ELK搭建日志管理平台"><a href="#FileBeat-Kafka-ELK搭建日志管理平台" class="headerlink" title="FileBeat+Kafka+ELK搭建日志管理平台"></a>FileBeat+Kafka+ELK搭建日志管理平台</h1><h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>ELK已经成为目前最流行的集中式日志解决方案，它主要是由Beats、Logstash、Elasticsearch、Kibana等组件组成，来共同完成实时日志的收集，存储，展示等一站式的解决方案。本文将会介绍ELK常见的架构以及相关问题解决。</p>
<p>Filebeat：Filebeat是一款轻量级，占用服务资源非常少的数据收集引擎，它也是ELK家族的新成员，可以代替Logstash作为在应用服务器端的日志收集引擎，支持将收集到的数据输出到Kafka，Redis等队列中。</p>
<p>Logstash：数据收集引擎，相较于Filebeat比较重量级，但它集成了大量的插件，支持丰富的数据源收集，对收集的数据可以过滤，分析，格式化日志格式。</p>
<p>Elasticsearch：分布式数据搜索引擎，基于Apache Lucene实现，可集群，提供数据的集中式存储，分析，以及强大的数据搜索和聚合功能。</p>
<p>Kibana：数据的可视化平台，通过该web平台可以实时的查看 Elasticsearch 中的相关数据，并提供了丰富的图表统计功能。</p>
<p>Kafka：是一种高吞吐量的分布式发布订阅消息系统，它可以处理消费者规模的网站中的所有动作流数据。</p>
<h2 id="2-常见部署架构"><a href="#2-常见部署架构" class="headerlink" title="2 常见部署架构"></a>2 常见部署架构</h2><h3 id="2-1-Logstash作为日志收集器"><a href="#2-1-Logstash作为日志收集器" class="headerlink" title="2.1 Logstash作为日志收集器"></a>2.1 Logstash作为日志收集器</h3><p>这种架构是比较原始的部署架构，在各应用服务器端分别部署一个Logstash组件，作为日志收集器，然后将Logstash收集到的数据过滤、分析、格式化处理后发送至Elasticsearch存储，最后使用Kibana进行可视化展示，这种架构的缺点是：Logstash比较耗服务器资源，所以会增加应用服务器端的负载压力。</p>
<p><img src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk/images/elk-1.png" alt="img"></p>
<h3 id="2-2-Filebeat作为日志收集器"><a href="#2-2-Filebeat作为日志收集器" class="headerlink" title="2.2 Filebeat作为日志收集器"></a>2.2 Filebeat作为日志收集器</h3><p>该架构与第一种架构唯一不同的是：应用端日志收集器换成了Filebeat，Filebeat是轻量级、占用服务器资源少，所以使用Filebeat作为应用服务器端的日志收集器，一般Filebeat会配合Logstash一起使用，这种部署方式也是目前最常用的架构。</p>
<p><img src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk/images/elk-2.png" alt="img"></p>
<h3 id="2-3-引入Kafka缓存队列的部署架构"><a href="#2-3-引入Kafka缓存队列的部署架构" class="headerlink" title="2.3 引入Kafka缓存队列的部署架构"></a>2.3 引入Kafka缓存队列的部署架构</h3><p>该架构在第二种架构的基础上引入了Kafka消息队列（还可以是其他消息队列），将Filebeat收集到的数据发送至Kafka，然后在通过Logstasth读取Kafka中的数据，这种架构主要是解决大数据量下的日志收集方案，使用缓存队列主要是解决数据安全与均衡Logstash与Elasticsearch负载压力。</p>
<p><img src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk/images/elk-3.png" alt="img"></p>
<h3 id="2-4-三种架构总结"><a href="#2-4-三种架构总结" class="headerlink" title="2.4 三种架构总结"></a>2.4 三种架构总结</h3><p>第一种部署架构由于资源占用问题，现已很少使用，目前使用最多的是第二种部署架构，至于第三种部署架构引入消息队列，除非有其他需求，因为在数据量较大的情况下，Filebeat 使用压力敏感协议向 Logstash 或 Elasticsearch 发送数据。如果 Logstash 正在繁忙地处理数据，它会告知 Filebeat 减慢读取速度。拥塞解决后，Filebeat 将恢复初始速度并继续发送数据。</p>
<h2 id="3-环境介绍"><a href="#3-环境介绍" class="headerlink" title="3 环境介绍"></a>3 环境介绍</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">3.1 软件版本：</span><br><span class="line">	- CentOS 7.6</span><br><span class="line">	- Java 1.8.0_202</span><br><span class="line">	- Elasticsearch 7.11.0</span><br><span class="line">	- Logstash 7.11.0</span><br><span class="line">	- Filebeat 7.11.0</span><br><span class="line">	- Kibana 7.11.0</span><br><span class="line">	- Kafka 2.7.0</span><br><span class="line">	- Zookeeper 3.4.14</span><br><span class="line">	</span><br><span class="line">3.2 服务器：</span><br><span class="line">	- 192.168.71.101	elk-master</span><br><span class="line">	- 192.168.71.102	elk-node1</span><br><span class="line">	- 192.168.71.103	elk-node2</span><br><span class="line"></span><br><span class="line">3.3 部署角色：</span><br><span class="line">	- elasticsearch：192.168.71.101、192.168.71.102、192.168.71.103</span><br><span class="line">		Elasticsearch 允许执行和合并多种类型的搜索 （ 结构化、非结构化、地理位置、度量指标 ）搜索方式。</span><br><span class="line">		</span><br><span class="line">	- logstash：192.168.71.101</span><br><span class="line">		Logstash 支持各种输入选择 ，可以在同一时间从众多常用来源捕捉事件。</span><br><span class="line">		</span><br><span class="line">	- kibana：192.168.71.101</span><br><span class="line">		Kibana 让您能够可视化 Elasticsearch 中的数据并操作 Elastic Stack。</span><br><span class="line">	</span><br><span class="line">	- Filebeat：192.168.71.102、192.168.71.103</span><br><span class="line">		Filebeat 内置的多种模块（auditd、Apache、NGINX、System 和 MySQL）可实现对常见日志格式的一键收集、解析和可视化。</span><br><span class="line">		</span><br><span class="line">	- Kafka：192.168.71.101、192.168.71.102、192.168.71.103</span><br><span class="line">		Kafka 是一种高吞吐量的分布式发布订阅消息系统，它可以处理消费者规模的网站中的所有动作流数据。</span><br></pre></td></tr></table></figure>

<h2 id="4-开始安装部署ELK"><a href="#4-开始安装部署ELK" class="headerlink" title="4 开始安装部署ELK"></a>4 开始安装部署ELK</h2><h3 id="4-1-部署前准备"><a href="#4-1-部署前准备" class="headerlink" title="4.1 部署前准备"></a>4.1 部署前准备</h3><blockquote>
<p>修改主机名(三台机器依次修改)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/hostname</span><br><span class="line">elk-master</span><br><span class="line"></span><br><span class="line">$ hostname elk-master</span><br><span class="line">$ bash</span><br><span class="line"></span><br><span class="line">$ hostname</span><br><span class="line">elk-master</span><br><span class="line"></span><br><span class="line">$ cat /etc/hosts</span><br><span class="line">192.168.71.101    elk-master</span><br><span class="line">192.168.71.102    elk-node2</span><br><span class="line">192.168.71.103    elk-node2</span><br><span class="line"></span><br><span class="line">$ systemctl stop firewalld</span><br><span class="line">$ systemctl disable firewalld</span><br><span class="line"></span><br><span class="line">$ vim /etc/security/limits.conf</span><br><span class="line">以下内容添加到末尾处</span><br><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 65536</span><br><span class="line"></span><br><span class="line">$ vim /etc/sysctl.conf </span><br><span class="line">以下内容添加到末尾处</span><br><span class="line">vm.max_map_count = 655360</span><br><span class="line">$ sysctl -p</span><br><span class="line">vm.max_map_count = 655360</span><br></pre></td></tr></table></figure>

<h3 id="4-2-安装-jdk8"><a href="#4-2-安装-jdk8" class="headerlink" title="4.2 安装 jdk8"></a>4.2 安装 jdk8</h3><blockquote>
<p>Kafka使用Zookeeper来保存相关配置信息，Kafka及Zookeeper依赖Java环境。</p>
</blockquote>
<h4 id="解压jdk安装包"><a href="#解压jdk安装包" class="headerlink" title="解压jdk安装包"></a>解压jdk安装包</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tar xf jdk-8u202-linux-x64.tar.gz</span><br><span class="line">$ mv jdk1.8.0_202/ java</span><br><span class="line">$ mv java /usr/local/</span><br></pre></td></tr></table></figure>

<h4 id="配置java环境变量"><a href="#配置java环境变量" class="headerlink" title="配置java环境变量"></a>配置java环境变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/profile</span><br><span class="line"># 最后添加以下几行内容</span><br><span class="line"></span><br><span class="line">export JAVA_HOME=/usr/local/java</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib</span><br><span class="line">export PATH=$&#123;JAVA_HOME&#125;/bin:$PATH</span><br></pre></td></tr></table></figure>

<h4 id="重载-etc-profile文件"><a href="#重载-etc-profile文件" class="headerlink" title="重载/etc/profile文件"></a>重载/etc/profile文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># source /etc/profile</span><br></pre></td></tr></table></figure>

<h4 id="查看Java版本"><a href="#查看Java版本" class="headerlink" title="查看Java版本"></a>查看Java版本</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># java -version </span><br><span class="line">java version &quot;1.8.0_202&quot;</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_202-b08)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.202-b08, mixed mode)</span><br></pre></td></tr></table></figure>

<h3 id="4-3-安装elasticsearch"><a href="#4-3-安装elasticsearch" class="headerlink" title="4.3 安装elasticsearch"></a>4.3 安装elasticsearch</h3><h4 id="创建-elk-用户及相应数据目录、日志目录"><a href="#创建-elk-用户及相应数据目录、日志目录" class="headerlink" title="创建 elk 用户及相应数据目录、日志目录"></a>创建 elk 用户及相应数据目录、日志目录</h4><blockquote>
<p><strong>三台同样操作</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ useradd elk</span><br><span class="line">$ mkdir -p /usr/elk/&#123;es_data,es_logs&#125;</span><br></pre></td></tr></table></figure>

<h4 id="解压源码包"><a href="#解压源码包" class="headerlink" title="解压源码包"></a>解压源码包</h4><blockquote>
<p><strong>elk-master</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ tar xf elasticsearch-7.11.0-linux-x86_64.tar.gz  -C /usr/elk/</span><br><span class="line">$ tar xf logstash-7.11.0-linux-x86_64.tar.gz -C /usr/elk/</span><br><span class="line">$ tar xf kibana-7.11.0-linux-x86_64.tar.gz -C /usr/elk/</span><br><span class="line">$ tar xf kafka_2.13-2.7.0.tgz -C /usr/elk/</span><br><span class="line">$ tar xf zookeeper-3.4.14.tar.gz -C /usr/elk</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>elk-node1、elk-node2</strong></p>
</blockquote>
<pre><code>$ tar xf elasticsearch-7.11.0-linux-x86_64.tar.gz -C  /usr/elk/
$ tar xf filebeat-7.11.0-linux-x86_64.tar.gz  -C /usr/elk/
$ tar xf tar xf kafka_2.13-2.7.0.tgz -C /usr/elk/
$ tar xf zookeeper-3.4.14.tar.gz -C /usr/elk</code></pre><h4 id="修改-elk-属主、属组"><a href="#修改-elk-属主、属组" class="headerlink" title="修改 elk 属主、属组"></a>修改 elk 属主、属组</h4><blockquote>
<p><strong>三台同样操作</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chown -R elk:elk /usr/elk/</span><br></pre></td></tr></table></figure>

<p><strong>切换 elk 用户用户进行安装</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ su - elk</span><br></pre></td></tr></table></figure>

<p><strong>修改elasticsearch.yml配置文件</strong></p>
<blockquote>
<p><strong>elk-master</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ grep -v &quot;^#&quot; /usr/elk/elasticsearch-7.11.0/config/elasticsearch.yml</span><br><span class="line">cluster.name: elk-cluster</span><br><span class="line">node.name: elk-master</span><br><span class="line">path.data: /usr/elk/es_data</span><br><span class="line">path.logs: /usr/elk/es_logs</span><br><span class="line">bootstrap.memory_lock: false</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">node.master: true</span><br><span class="line">node.data: true</span><br><span class="line">discovery.seed_hosts: [&quot;elk-master&quot;, &quot;elk-node1&quot;, &quot;elk-node2&quot;]</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br><span class="line">cluster.initial_master_nodes: [&quot;elk-master&quot;]</span><br><span class="line">http.cors.enabled: true                         </span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>elk-node1</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ grep -v &quot;^#&quot; /usr/elk/elasticsearch-7.11.0/config/elasticsearch.yml</span><br><span class="line">cluster.name: elk-cluster</span><br><span class="line">node.name: elk-node1</span><br><span class="line">path.data: /usr/elk/es_data</span><br><span class="line">path.logs: /usr/elk/es_logs</span><br><span class="line">bootstrap.memory_lock: false</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">node.master: false</span><br><span class="line">node.data: true</span><br><span class="line">discovery.seed_hosts: [&quot;elk-master&quot;, &quot;elk-node1&quot;, &quot;elk-node2&quot;]</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br><span class="line">cluster.initial_master_nodes: [&quot;elk-master&quot;]</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>elk-node2</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ grep -v &quot;^#&quot; /usr/elk/elasticsearch-7.11.0/config/elasticsearch.yml</span><br><span class="line">cluster.name: elk-cluster	</span><br><span class="line">node.name: elk-node2</span><br><span class="line">path.data: /usr/elk/es_data</span><br><span class="line">path.logs: /usr/elk/es_logs</span><br><span class="line">bootstrap.memory_lock: false</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">node.master: false</span><br><span class="line">node.data: true</span><br><span class="line">discovery.seed_hosts: [&quot;elk-master&quot;, &quot;elk-node1&quot;, &quot;elk-node2&quot;]</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br><span class="line">cluster.initial_master_nodes: [&quot;elk-master&quot;]</span><br></pre></td></tr></table></figure>

<h4 id="elasticsearch配置文件解析"><a href="#elasticsearch配置文件解析" class="headerlink" title="elasticsearch配置文件解析"></a>elasticsearch配置文件解析</h4><blockquote>
<p>cluster.name: elk-cluster                     #集群名称,一定要一致,当集群内节点启动的时候,默认使用组播(多播),寻找集群中的节点<br>node.name: elk-master                       #节点名称<br>path.data: /usr/elk/es_data                 #数据目录<br>path.logs: /usr/elk/es_logs                  #日志目录<br>bootstrap.memory_lock: false            #启动时不锁定内存<br>network.host: 0.0.0.0                            #监听IP<br>http.port: 9200                                       #服务监听端口,默认9200<br>transport.tcp.port: 9300                       #集群内通信端口,默认9300<br>node.master: false                                 #是否当做主节点<br>node.data: true                                      #是否当做数据节点<br>discovery.seed_hosts: [“elk-master”, “elk-node1”, “elk-node2”]   #集群中其他成员,需要能解析,请先做好host<br>discovery.zen.minimum_master_nodes: 2                 #成为master需要的最小票数<br>cluster.initial_master_nodes: [“elk-master”]              #初始主节点配置<br>http.cors.enabled: true            #允许跨域配置<br>http.cors.allow-origin: “*”        #允许跨域配置</p>
</blockquote>
<h4 id="编写elasticsearch服务启动程序"><a href="#编写elasticsearch服务启动程序" class="headerlink" title="编写elasticsearch服务启动程序"></a>编写elasticsearch服务启动程序</h4><blockquote>
<p><strong>三台同样操作</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ su - root</span><br><span class="line"></span><br><span class="line">$ vim /usr/lib/systemd/system/elasticsearch.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=elasticsearch</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=elk</span><br><span class="line">Group=elk</span><br><span class="line">LimitNOFILE=100000</span><br><span class="line">LimitNPROC=100000</span><br><span class="line">Restart=no</span><br><span class="line">ExecStart=/usr/elk/elasticsearch-7.11.0/bin/elasticsearch</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<h4 id="启动-elasticsearch-服务"><a href="#启动-elasticsearch-服务" class="headerlink" title="启动 elasticsearch  服务"></a>启动 elasticsearch  服务</h4><blockquote>
<p><strong>三台同样操作</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl daemon-reload</span><br><span class="line">$ systemctl start elasticsearch</span><br><span class="line">$ systemctl enable elasticsearch</span><br></pre></td></tr></table></figure>

<h4 id="检查-elasticsearch-服务状态"><a href="#检查-elasticsearch-服务状态" class="headerlink" title="检查 elasticsearch 服务状态"></a>检查 elasticsearch 服务状态</h4><blockquote>
<p><strong>三台同样操作</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ss -tanl | egrep &quot;9200|9300&quot;</span><br><span class="line">LISTEN     0      128         :::9200                    :::*                  </span><br><span class="line">LISTEN     0      128         :::9300                    :::*</span><br></pre></td></tr></table></figure>

<h3 id="访问验证"><a href="#访问验证" class="headerlink" title="访问验证"></a>访问验证</h3><blockquote>
<p><strong>浏览器访问9200端口查看节点信息情况</strong></p>
</blockquote>
<p><a href="http://192.168.71.101:9200/" target="_blank" rel="noopener">http://192.168.71.101:9200/</a></p>
<p><img src="https://img-blog.csdnimg.cn/2021032415161713.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><a href="http://192.168.71.102:9200/" target="_blank" rel="noopener">http://192.168.71.102:9200/</a></p>
<p><img src="https://img-blog.csdnimg.cn/20210324151544868.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><a href="http://192.168.71.103:9200/" target="_blank" rel="noopener">http://192.168.71.103:9200/</a></p>
<p><img src="https://img-blog.csdnimg.cn/20210324151525786.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="查看集群健康状态"><a href="#查看集群健康状态" class="headerlink" title="查看集群健康状态"></a>查看集群健康状态</h4><blockquote>
<p><strong>查看集群健康状态(status为green代表集群健康)</strong></p>
</blockquote>
<p><a href="http://192.168.71.101:9200/_cluster/health?pretty" target="_blank" rel="noopener">http://192.168.71.101:9200/_cluster/health?pretty</a></p>
<p><img src="https://img-blog.csdnimg.cn/2021032415145256.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>到此elasticsearch已完成安装</strong></p>
<h3 id="4-4-部署-Kafka-zookeeper-集群"><a href="#4-4-部署-Kafka-zookeeper-集群" class="headerlink" title="4.4 部署 Kafka zookeeper 集群"></a>4.4 部署 Kafka zookeeper 集群</h3><p><strong>zookeeper</strong> 下载地址：<a href="https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.6.2/apache-zookeeper-3.6.2.tar.gz" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.6.2/apache-zookeeper-3.6.2.tar.gz</a> </p>
<h4 id="创建zookeeper目录"><a href="#创建zookeeper目录" class="headerlink" title="创建zookeeper目录"></a>创建zookeeper目录</h4><blockquote>
<p><strong>三台同样操作</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ su - elk</span><br><span class="line">$ mkdir /usr/elk/&#123;zk_data,zk_logs&#125;</span><br></pre></td></tr></table></figure>

<h4 id="修改-zookeeper-配置文件"><a href="#修改-zookeeper-配置文件" class="headerlink" title="修改 zookeeper 配置文件"></a>修改 zookeeper 配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/elk/zookeeper-3.4.14/conf/</span><br><span class="line">$ cp zoo_sample.cfg zoo.cfg</span><br><span class="line">$ grep -v &quot;^#&quot; zoo.cfg </span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=20</span><br><span class="line">syncLimit=10</span><br><span class="line">dataDir=/usr/elk/zk_data</span><br><span class="line">dataLogDir=/usr/elk/zk_logs</span><br><span class="line">autopurge.snapRetainCount=3</span><br><span class="line">autopurge.purgeInterval=1</span><br><span class="line">clientPort=2181</span><br><span class="line">server.0=192.168.71.101:2888:3888</span><br><span class="line">server.1=192.168.71.102:2888:3888</span><br><span class="line">server.2=192.168.71.103:2888:3888</span><br></pre></td></tr></table></figure>

<h4 id="zookeeper配置文件解析"><a href="#zookeeper配置文件解析" class="headerlink" title="zookeeper配置文件解析"></a>zookeeper配置文件解析</h4><blockquote>
<p>tickTime=2000             #客户端与服务器或者服务器与服务器之间每个tickTime时间就会发送一次心跳。通过心跳不仅能够用来监听机器的工作状态，还可以通过心跳来控制Flower跟Leader的通信时间，默认2秒<br>initLimit=20                  #集群中的follower服务器(F)与leader服务器(L)之间初始连接时能容忍的最多心跳数（tickTime的数量）<br>syncLimit=10                #集群中flower服务器（F）跟leader（L）服务器之间的请求和答应最多能容忍的心跳数<br>dataDir=/usr/elk/zk_data    #该属性对应的目录是用来存放myid信息跟一些版本，日志，跟服务器唯一的ID信息等<br>dataLogDir=/usr/elk/zk_logs    #日志目录<br>clientPort=2181            #客户端连接的接口，客户端连接zookeeper服务器的端口，zookeeper会监听这个端口，接收客户端的请求访问！这个端口默认是2181<br>server.N=YYY:A:B<br>        N：代表服务器编号（也就是myid里面的值）<br>        YYY：服务器地址<br>        A：表示 Flower 跟 Leader的通信端口，简称服务端内部通信的端口（默认2888）<br>        B：表示 是选举端口（默认是3888）</p>
</blockquote>
<h4 id="配置-Zookeeper-环境变量"><a href="#配置-Zookeeper-环境变量" class="headerlink" title="配置 Zookeeper 环境变量"></a>配置 Zookeeper 环境变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ echo &apos;ZOOKEEPER_HOME=/usr/elk/zookeeper-3.4.14&apos; &gt; /etc/profile.d/zk.sh</span><br><span class="line">$ echo &apos;PATH=$ZOOKEEPER_HOME/bin:$PATH&apos; &gt;&gt; /etc/profile.d/zk.sh</span><br><span class="line">$ source /etc/profile.d/zk.sh</span><br></pre></td></tr></table></figure>

<h4 id="配置-myid-文件"><a href="#配置-myid-文件" class="headerlink" title="配置 myid 文件"></a>配置 myid 文件</h4><blockquote>
<p>除了修改 zoo.cfg 配置文件，集群模式下还要配置一个文件 myid，这个文件在 上述dataDir 指定的目录下，这个文件里面就只有一个数据就是 A 的值，Zookeeper 启动时会读取这个文件，拿到里面的数据与 zoo.cfg 里面的配置信息比较从而判断到底是那个 server。</p>
</blockquote>
<blockquote>
<p><strong>elk-master</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;0&quot; &gt; /usr/elk/zk_data/myid</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>elk-node1</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;1&quot; &gt; /usr/elk/zk_data/myid</span><br></pre></td></tr></table></figure>

<blockquote>
<p> <strong>elk-node2</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ echo &quot;2&quot; &gt;&gt;/usr/elk/zk_data/myid</span><br></pre></td></tr></table></figure>

<h4 id="启动-zookeeper"><a href="#启动-zookeeper" class="headerlink" title="启动 zookeeper"></a>启动 zookeeper</h4><blockquote>
<p>在 ZooKeeper 集群的每个结点上，执行启动ZooKeeper服务的脚本。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/elk/zookeeper-3.4.14/bin/</span><br><span class="line">$ zkServer.sh start</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/elk/zookeeper-3.4.14/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br></pre></td></tr></table></figure>

<h4 id="验证-zookeeper-节点状态"><a href="#验证-zookeeper-节点状态" class="headerlink" title="验证 zookeeper 节点状态"></a>验证 zookeeper 节点状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/elk/zookeeper-3.4.14/bin/../conf/zoo.cfg</span><br><span class="line">Mode: follower</span><br><span class="line"></span><br><span class="line">$ ss -tanl | grep 2181</span><br><span class="line">LISTEN     0      50          :::2181                    :::*</span><br></pre></td></tr></table></figure>

<h3 id="Kafka-集群安装与配置"><a href="#Kafka-集群安装与配置" class="headerlink" title="Kafka 集群安装与配置"></a><strong>Kafka 集群安装与配置</strong></h3><p><strong>Kafka下载地址：</strong><a href="https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.7.0/kafka_2.13-2.7.0.tgz" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.7.0/kafka_2.13-2.7.0.tgz</a></p>
<h4 id="配置-Kafka-配置文件"><a href="#配置-Kafka-配置文件" class="headerlink" title="配置 Kafka 配置文件"></a>配置 Kafka 配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">创建日志存放目录</span><br><span class="line">$ mkdir -p /usr/elk/kafka_logs</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>elk-master、elk-node1、elk-node2</strong></p>
<p><strong>注: 其他两个节点的配置文件也基本相同，只有一个参数需要修改 broker.id（它用于唯一标识节点，所以绝对不能相同，不然会节点冲突）和listeners的ip 。</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/elk/kafka_2.13-2.7.0/config</span><br><span class="line"></span><br><span class="line">$ cp server.properties server.properties-bak</span><br><span class="line"></span><br><span class="line">$ egrep -v &quot;^#|^$&quot; server.properties</span><br><span class="line">broker.id=101</span><br><span class="line">listeners=PLAINTEXT://192.168.71.101:9092</span><br><span class="line">num.network.threads=3</span><br><span class="line">num.io.threads=8</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line">log.dirs=/usr/elk/kafka_logs</span><br><span class="line">num.partitions=3</span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line">log.retention.hours=168</span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line">zookeeper.connect=192.168.71.101:2181,192.168.71.102:2181,192.168.71.103:2181</span><br><span class="line">zookeeper.connection.timeout.ms=6000</span><br><span class="line">group.initial.rebalance.delay.ms=0</span><br></pre></td></tr></table></figure>

<h4 id="kafka配置文件解析"><a href="#kafka配置文件解析" class="headerlink" title="kafka配置文件解析"></a>kafka配置文件解析</h4><blockquote>
<p>broker.id=101        #每一个broker在集群中的唯一表示，要求是正数<br>listeners=PLAINTEXT://192.168.71.101:9092    #监控的kafka端口<br>num.network.threads=3      #broker处理消息的最大线程数，一般情况下不需要去修改<br>num.io.threads=8        #broker处理磁盘IO的线程数，数值应该大于你的硬盘数<br>socket.send.buffer.bytes=102400   #socket的发送缓冲区<br>socket.receive.buffer.bytes=102400 #socket的接受缓冲区<br>socket.request.max.bytes=104857600 #socket请求的最大字节数<br>log.dirs=/usr/elk/kafka_logs #kafka数据的存放地址,多个地址用逗号分割,多个目录分布在不同磁盘上可以提高读写性能<br>num.partitions=3          #设置partitions 的个数<br>num.recovery.threads.per.data.dir=1<br>offsets.topic.replication.factor=1<br>transaction.state.log.replication.factor=1<br>transaction.state.log.min.isr=1<br>log.retention.hours=168       #数据文件保留多长时间,此处为168h,粒度还可设置为分钟,或按照文件大小<br>log.segment.bytes=1073741824    #topic的分区是以一堆segment文件存储的,这个控制每个segment的大小,会被topic创建时的指定参数覆盖<br>log.retention.check.interval.ms=300000<br>zookeeper.connect=192.168.71.101:2181,192.168.71.102:2181,192.168.71.103:2181  #zookeeper集群地址<br>zookeeper.connection.timeout.ms=6000  #kafka连接Zookeeper的超时时间<br>group.initial.rebalance.delay.ms=0</p>
</blockquote>
<h4 id="配置-Kafka-环境变量"><a href="#配置-Kafka-环境变量" class="headerlink" title="配置 Kafka 环境变量"></a>配置 Kafka 环境变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ echo &apos;KAFKA_HOME=/usr/elk/kafka_2.13-2.7.0&apos; &gt; /etc/profile.d/kfk.sh</span><br><span class="line">$ echo &apos;PATH=$KAFKA_HOME/bin:$PATH&apos; &gt;&gt; /etc/profile.d/kfk.sh</span><br><span class="line">$ source /etc/profile.d/kfk.sh</span><br></pre></td></tr></table></figure>

<h4 id="启动-Kafka-服务"><a href="#启动-Kafka-服务" class="headerlink" title="启动 Kafka 服务"></a>启动 Kafka 服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kafka-server-start.sh -daemon /usr/elk/kafka_2.13-2.7.0/config/server.properties</span><br></pre></td></tr></table></figure>

<p><strong>到此kafka zookeeper集群已搭建完成</strong></p>
<h3 id="Filebeat收集系统日志"><a href="#Filebeat收集系统日志" class="headerlink" title="Filebeat收集系统日志"></a>Filebeat收集系统日志</h3><blockquote>
<p><strong>配置 Filebeat 收集系统日志并写入kafka，logstash 从 kafka 中读取数据并传给 elasticsearch，从而 kibana 进行展示。（注：因为filebeat启动用户是 elk ，所以系统日志 /var/log/messages 文件需要添加其他用户可读权限。不然filebeat启动会报错 ）</strong></p>
</blockquote>
<h4 id="系统日志文件添加权限"><a href="#系统日志文件添加权限" class="headerlink" title="系统日志文件添加权限"></a>系统日志文件添加权限</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ll /var/log/messages</span><br><span class="line">-rw------- 1 root root 1865601 Mar 25 10:37 /var/log/messages</span><br><span class="line"></span><br><span class="line">$ chmod 644 /var/log/messages</span><br><span class="line">$ ll /var/log/messages</span><br><span class="line">-rw-r--r-- 1 root root 1866249 Mar 25 10:38 /var/log/messages</span><br></pre></td></tr></table></figure>

<h4 id="Filebeat配置"><a href="#Filebeat配置" class="headerlink" title="Filebeat配置"></a>Filebeat配置</h4><blockquote>
<p><strong>elk-node1、elk-node2</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cat /usr/elk/filebeat-7.11.0-linux-x86_64/filebeat.yml</span><br><span class="line">filebeat.inputs:</span><br><span class="line">- type: log</span><br><span class="line">  enabled: true</span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/messages</span><br><span class="line"></span><br><span class="line">output.kafka:</span><br><span class="line">  hosts: [&quot;192.168.71.101:9092&quot;,&quot;192.168.71.102:9092&quot;,&quot;192.168.71.103:9092&quot;]</span><br><span class="line">  topic: messages-topics</span><br><span class="line">  keep_alive: 10s</span><br></pre></td></tr></table></figure>

<h4 id="filebeat配置文件解析"><a href="#filebeat配置文件解析" class="headerlink" title="filebeat配置文件解析"></a>filebeat配置文件解析</h4><blockquote>
<p>filebeat.inputs:    #从哪里收集<br>output.kafka:       #收集的数据写到哪里去<br>topic: messages-topics    #写到哪个topics</p>
</blockquote>
<h4 id="编写Filebeat服务程序"><a href="#编写Filebeat服务程序" class="headerlink" title="编写Filebeat服务程序"></a>编写Filebeat服务程序</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ vim /usr/lib/systemd/system/filebeat.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=filebeat</span><br><span class="line">Wants=network-online.target</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=elk</span><br><span class="line">Group=elk</span><br><span class="line">Environment=&quot;BEAT_LOG_OPTS=-e&quot;</span><br><span class="line">Environment=&quot;BEAT_CONFIG_OPTS=-c /usr/elk/filebeat-7.11.0-linux-x86_64//filebeat.yml&quot;</span><br><span class="line">ExecStart=/usr/elk/filebeat-7.11.0-linux-x86_64//filebeat $BEAT_LOG_OPTS $BEAT_CONFIG_OPTS</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<h4 id="启动-Filebeat-并设置开机自启"><a href="#启动-Filebeat-并设置开机自启" class="headerlink" title="启动 Filebeat 并设置开机自启"></a>启动 Filebeat 并设置开机自启</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl daemon-reload</span><br><span class="line">$ systemctl start filebeat</span><br><span class="line">$ systemctl enable filebeat</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>当Filebeat启用没问题，此时数据就能写到kafka中了。</strong></p>
</blockquote>
<h4 id="查看kafka中是否创建了topics"><a href="#查看kafka中是否创建了topics" class="headerlink" title="查看kafka中是否创建了topics"></a>查看kafka中是否创建了topics</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kafka-topics.sh --list --zookeeper 192.168.71.101:2181,192.168.71.102:2181,192.168.71.103:2181</span><br><span class="line">__consumer_offsets</span><br><span class="line">messages-topics</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>上面显示  “messages-topics” 说明kafka已有数据，还需使用logstash从kafka中读取数据，交给elasticsearch。</strong></p>
</blockquote>
<h4 id="配置启用-Logstash-读取-kafka-中数据"><a href="#配置启用-Logstash-读取-kafka-中数据" class="headerlink" title="配置启用 Logstash 读取 kafka 中数据"></a>配置启用 Logstash 读取 kafka 中数据</h4><blockquote>
<p><strong>elk-master</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/elk/logstash-7.11.0/config/</span><br><span class="line">$ cp logstash-sample.conf logstash.conf</span><br><span class="line">$ cat logstash.conf</span><br><span class="line"></span><br><span class="line">input &#123;</span><br><span class="line">    kafka &#123;</span><br><span class="line">        bootstrap_servers =&gt; &quot;192.168.71.101:9092,192.168.71.102:9092,192.168.71.102:9092&quot;</span><br><span class="line">        group_id =&gt; &quot;logstash&quot;</span><br><span class="line">        auto_offset_reset =&gt; &quot;earliest&quot;</span><br><span class="line">        decorate_events =&gt; true</span><br><span class="line">        topics =&gt; [&quot;messages-topics&quot;]</span><br><span class="line">        type =&gt; &quot;messages&quot;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  if [type] == &quot;messages&quot; &#123;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line">        hosts =&gt; [&quot;192.168.71.101:9200&quot;]</span><br><span class="line">        index =&gt; &quot;messages-log-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="logstash配置文件解析"><a href="#logstash配置文件解析" class="headerlink" title="logstash配置文件解析"></a>logstash配置文件解析</h4><blockquote>
<p>group_id =&gt; “logstash”        #此消费者所属的组的标识符,消费者组是由多个处理器组成的单个逻辑订阅服务器，主题中的消息将分发给具有相同group_id的所有Logstash实例<br>auto_offset_reset =&gt; “earliest”  #如果Kafka中没有初始偏移量,或者偏移量超出范围,自动重置偏移量到最早的偏移量<br>decorate_events =&gt; true      #在输出消息的时候会输出自身的信息包括:消费消息的大小,topic 来源以及 consumer 的 group 信息<br>topics =&gt; [“messages-topics”]   #哪个topics取数据<br>type =&gt; “messages”         #用于其他插件进行判断</p>
</blockquote>
<h4 id="编写logstash服务程序"><a href="#编写logstash服务程序" class="headerlink" title="编写logstash服务程序"></a>编写logstash服务程序</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ vim /usr/lib/systemd/system/logstash.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=logstash</span><br><span class="line">Wants=network-online.target</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=elk</span><br><span class="line">Group=elk</span><br><span class="line">ExecStart=/usr/elk/logstash-7.11.0/bin/logstash -f /usr/elk/logstash-7.11.0/config/logstash.conf</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<h4 id="启动-Logstash-并设置开机自启"><a href="#启动-Logstash-并设置开机自启" class="headerlink" title="启动 Logstash 并设置开机自启"></a>启动 Logstash 并设置开机自启</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl daemon-reload</span><br><span class="line">$ systemctl start logstash</span><br><span class="line">$ systemctl enable logstash</span><br></pre></td></tr></table></figure>

<h4 id="配置-kibana"><a href="#配置-kibana" class="headerlink" title="配置 kibana"></a>配置 kibana</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ egrep -v &quot;^#|^$&quot; /usr/elk/kibana-7.11.0-linux-x86_64/config/kibana.yml</span><br><span class="line"></span><br><span class="line">server.port: 5601</span><br><span class="line">server.host: &quot;192.168.71.101&quot;</span><br><span class="line">server.name: &quot;elk-kibana&quot;</span><br><span class="line">elasticsearch.hosts: [&quot;http://192.168.71.101:9200&quot;]</span><br></pre></td></tr></table></figure>

<h4 id="编写kibana服务程序"><a href="#编写kibana服务程序" class="headerlink" title="编写kibana服务程序"></a>编写kibana服务程序</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ vim /usr/lib/systemd/system/kibana.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=kibana</span><br><span class="line">Wants=network-online.target</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=elk</span><br><span class="line">Group=elk</span><br><span class="line">ExecStart=/usr/elk/kibana-7.11.0-linux-x86_64/bin/kibana</span><br><span class="line">Restart=always </span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<h4 id="启动-kibana-并设置开机自启"><a href="#启动-kibana-并设置开机自启" class="headerlink" title="启动 kibana 并设置开机自启"></a>启动 kibana 并设置开机自启</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl daemon-reload</span><br><span class="line">$ systemctl start kibana</span><br><span class="line">$ systemctl enable kibana</span><br></pre></td></tr></table></figure>

<h4 id="验证kibana"><a href="#验证kibana" class="headerlink" title="验证kibana"></a>验证kibana</h4><p>访问 <a href="http://192.168.71.101:5601/" target="_blank" rel="noopener">http://192.168.71.101:5601/</a></p>
<p><img src="https://img-blog.csdnimg.cn/20210324182234196.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="在kibana添加索引"><a href="#在kibana添加索引" class="headerlink" title="在kibana添加索引"></a>在kibana添加索引</h4><p><img src="https://img-blog.csdnimg.cn/20210324182624340.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20210324185904682.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20210325105541489.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20210325105621281.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20210325105641309.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p><strong>至此，kibana添加系统日志索引完成</strong></p>
</blockquote>
<h4 id="kibana查看索引"><a href="#kibana查看索引" class="headerlink" title="kibana查看索引"></a>kibana查看索引</h4><p><img src="https://img-blog.csdnimg.cn/20210325105836933.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210325105905520.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p><strong>至此，日志系统流程就走通了</strong></p>
</blockquote>
<h3 id="业务服务器-Filebeat收集Nginx日志"><a href="#业务服务器-Filebeat收集Nginx日志" class="headerlink" title="业务服务器+Filebeat收集Nginx日志"></a>业务服务器+Filebeat收集Nginx日志</h3><blockquote>
<p><strong>配置 Filebeat 收集 nginx 日志并写入kafka，logstash 从 kafka 中读取数据并传给 elasticsearch，从而 kibana 进行展示。</strong></p>
</blockquote>
<h4 id="定制nginx日志格式为json"><a href="#定制nginx日志格式为json" class="headerlink" title="定制nginx日志格式为json"></a>定制nginx日志格式为json</h4><blockquote>
<p><strong>elk-node1、elk-node2</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">    log_format log_json &apos;&#123; &quot;@timestamp&quot;: &quot;$time_local&quot;, &apos;</span><br><span class="line">                        &apos;&quot;remote_addr&quot;: &quot;$remote_addr&quot;, &apos;</span><br><span class="line">                        &apos;&quot;referer&quot;: &quot;$http_referer&quot;, &apos;</span><br><span class="line">                        &apos;&quot;request&quot;: &quot;$request&quot;, &apos;</span><br><span class="line">                        &apos;&quot;status&quot;: $status, &apos;</span><br><span class="line">                        &apos;&quot;bytes&quot;: $body_bytes_sent, &apos;</span><br><span class="line">                        &apos;&quot;agent&quot;: &quot;$http_user_agent&quot;, &apos;</span><br><span class="line">                        &apos;&quot;x_forwarded&quot;: &quot;$http_x_forwarded_for&quot;, &apos;</span><br><span class="line">                        &apos;&quot;up_addr&quot;: &quot;$upstream_addr&quot;,&apos;</span><br><span class="line">                        &apos;&quot;up_host&quot;: &quot;$upstream_http_host&quot;,&apos;</span><br><span class="line">                        &apos;&quot;up_resp_time&quot;: &quot;$upstream_response_time&quot;,&apos;</span><br><span class="line">                        &apos;&quot;request_time&quot;: &quot;$request_time&quot;&apos;</span><br><span class="line">&apos; &#125;&apos;;</span><br><span class="line"></span><br><span class="line">     access_log  /var/log/nginx/access.log  log_json;</span><br><span class="line"></span><br><span class="line">启动nginx</span><br><span class="line">$ nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class="line"></span><br><span class="line">$ systemctl start nginx</span><br><span class="line"></span><br><span class="line">$ netstat -anpt | grep 80</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      114490/nginx: maste</span><br></pre></td></tr></table></figure>

<h4 id="Filebeat配置-1"><a href="#Filebeat配置-1" class="headerlink" title="Filebeat配置"></a>Filebeat配置</h4><blockquote>
<p><strong>上面收集了系统日志，现在再加上nginx访问日志</strong></p>
</blockquote>
<blockquote>
<p><strong>elk-node1、elk-node2</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ cat /usr/elk/filebeat-7.11.0-linux-x86_64/filebeat.yml</span><br><span class="line">filebeat.inputs:</span><br><span class="line"></span><br><span class="line">- type: log</span><br><span class="line">  enabled: true</span><br><span class="line"></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/messages</span><br><span class="line"></span><br><span class="line">  fields:</span><br><span class="line">    topics: messages-topics</span><br><span class="line"></span><br><span class="line">- type: log</span><br><span class="line">  enabled: true</span><br><span class="line"></span><br><span class="line">  paths:</span><br><span class="line">    - /var/log/nginx/access_json.log</span><br><span class="line"></span><br><span class="line">  fields:</span><br><span class="line">    topics: nginx-access-topics</span><br><span class="line"></span><br><span class="line">output.kafka:</span><br><span class="line">  hosts: [&quot;192.168.71.101:9092&quot;,&quot;192.168.71.102:9092&quot;,&quot;192.168.71.103:9092&quot;]</span><br><span class="line">  topic: &apos;%&#123;[fields][topics]&#125;&apos;</span><br><span class="line">  keep_alive: 10s</span><br></pre></td></tr></table></figure>

<h4 id="重启-Filebeat-服务"><a href="#重启-Filebeat-服务" class="headerlink" title="重启 Filebeat 服务"></a>重启 Filebeat 服务</h4><blockquote>
<p><strong>elk-node1、elk-node2</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl restart filebeat</span><br></pre></td></tr></table></figure>

<h4 id="查看kafka中是否创建了topics-1"><a href="#查看kafka中是否创建了topics-1" class="headerlink" title="查看kafka中是否创建了topics"></a>查看kafka中是否创建了topics</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kafka-topics.sh --list --zookeeper 192.168.71.101:2181,192.168.71.102:2181,192.168.71.103:2181</span><br><span class="line">__consumer_offsets</span><br><span class="line">messages-topics</span><br><span class="line">nginx-access-topics</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>上面显示  “messages-topics”  “nginx-access-topics” 说明kafka已有数据，还需使用logstash从kafka中读取数据，交给elasticsearch。</strong></p>
</blockquote>
<h4 id="配置启用-Logstash-读取-kafka-中数据-1"><a href="#配置启用-Logstash-读取-kafka-中数据-1" class="headerlink" title="配置启用 Logstash 读取 kafka 中数据"></a>配置启用 Logstash 读取 kafka 中数据</h4><blockquote>
<p><strong>elk-master</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">$ cat /usr/elk/logstash-7.11.0/config/logstash.conf</span><br><span class="line"></span><br><span class="line">input &#123;</span><br><span class="line">    kafka &#123;</span><br><span class="line">        bootstrap_servers =&gt; &quot;192.168.71.101:9092,192.168.71.102:9092,192.168.71.102:9092&quot;</span><br><span class="line">        group_id =&gt; &quot;logstash&quot;</span><br><span class="line">        auto_offset_reset =&gt; &quot;earliest&quot;</span><br><span class="line">        decorate_events =&gt; true</span><br><span class="line">        topics =&gt; [&quot;messages-topics&quot;]</span><br><span class="line">        type =&gt; &quot;messages&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    kafka &#123;</span><br><span class="line">        bootstrap_servers =&gt; &quot;192.168.71.101:9092,192.168.71.102:9092,192.168.71.102:9092&quot;</span><br><span class="line">        group_id =&gt; &quot;logstash&quot;</span><br><span class="line">        auto_offset_reset =&gt; &quot;earliest&quot;</span><br><span class="line">        decorate_events =&gt; true</span><br><span class="line">        topics =&gt; [&quot;nginx-access-topics&quot;]</span><br><span class="line">        type =&gt; &quot;nginx-access&quot;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">  if [type] == &quot;messages&quot; &#123;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line">        hosts =&gt; [&quot;192.168.71.101:9200&quot;]</span><br><span class="line">        index =&gt; &quot;messages-log-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  if [type] == &quot;nginx-access&quot; &#123;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line">        hosts =&gt; [&quot;192.168.71.101:9200&quot;]</span><br><span class="line">        index =&gt; &quot;nginx-access-log-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="重启-Logstash-服务"><a href="#重启-Logstash-服务" class="headerlink" title="重启 Logstash 服务"></a>重启 Logstash 服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl restart logstash</span><br></pre></td></tr></table></figure>

<h4 id="kibana-查看索引"><a href="#kibana-查看索引" class="headerlink" title="kibana 查看索引"></a>kibana 查看索引</h4><blockquote>
<p><strong>在 Index Management 里可查看新的索引。下图可看到有两个索引，分别是系统日志和nginx日志索引。</strong></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/20210325113125826.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="kibana-添加索引"><a href="#kibana-添加索引" class="headerlink" title="kibana 添加索引"></a>kibana 添加索引</h4><p><img src="https://img-blog.csdnimg.cn/20210325113422358.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210325113453493.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210325113513403.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20210325113530954.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODc3OTI1OA==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<blockquote>
<p><strong>至此，kibana nginx日志索引已创建完成，可在 “Discover” 中查看日志</strong></p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/299aa84008d544df83a839d53548e486.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<blockquote>
<p><strong>至此，就能简单实现日志采集、分类、索引、展示等功能了</strong></p>
</blockquote>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">RenChing Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2021/12/26/FileBeat-Kafka-ELK-V7-11-0搭建日志管理平台/">http://yoursite.com/2021/12/26/FileBeat-Kafka-ELK-V7-11-0搭建日志管理平台/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ELK/">ELK    </a><a class="post-meta__tags" href="/tags/Kafka/">Kafka    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk+filebeat+kafka.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-buttom"><i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/alipay.jpg"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2021/12/26/Elasticsearch7-x-x开启X-pack鉴权/"><img class="prev_cover lozad" data-src="https://img-blog.csdnimg.cn/925fc0751167442381ca7e0bc089776d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Previous Post</div><div class="prev_info"><span>Elasticsearch7.x.x开启X-pack鉴权</span></div></a></div><div class="next-post pull-right"><a href="/2021/12/25/Docker-可视化管理工具之-Portainer/"><img class="next_cover lozad" data-src="https://img-blog.csdnimg.cn/26f5f4840a3c4430bc438e7042d24018.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>Docker 可视化管理工具之 Portainer</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span>Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2019/09/16/FileBeat-Kafka-ELK搭建日志管理平台/" title="FileBeat+Kafka+ELK_V6.4.0搭建日志管理平台"><img class="relatedPosts_cover lozad" data-src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk+filebeat+kafka.png"><div class="relatedPosts_title">FileBeat+Kafka+ELK_V6.4.0搭建日志管理平台</div></a></div><div class="relatedPosts_item"><a href="/2021/12/26/Elasticsearch7-x-x开启X-pack鉴权/" title="Elasticsearch7.x.x开启X-pack鉴权"><img class="relatedPosts_cover lozad" data-src="https://img-blog.csdnimg.cn/925fc0751167442381ca7e0bc089776d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16"><div class="relatedPosts_title">Elasticsearch7.x.x开启X-pack鉴权</div></a></div></div><div class="clear_both"></div></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2021 By RenChing Doe</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://renqingsangbu.github.io/">blog</a>!</div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-book" id="readmode" title="Read Mode"> </i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion">繁</a><i class="fa fa-moon-o nightshift" id="nightshift" title="Dark Mode"></i></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="/js/nightshift.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zindex="-1" data-click="false"></script><script src="/js/activate-power-mode.js"></script><script>POWERMODE.colorful = true; // make power mode colorful
POWERMODE.shake = true; // turn off shake
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script></body></html>