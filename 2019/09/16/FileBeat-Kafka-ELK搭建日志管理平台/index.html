<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>FileBeat+Kafka+ELK_V6.4.0搭建日志管理平台 | RenChing</title><meta name="description" content="FileBeat+Kafka+ELK_V6.4.0搭建日志管理平台"><meta name="keywords" content="ELK,Kafka"><meta name="author" content="RenChing Doe"><meta name="copyright" content="RenChing Doe"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://yoursite.com/2019/09/16/FileBeat-Kafka-ELK搭建日志管理平台/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="FileBeat+Kafka+ELK_V6.4.0搭建日志管理平台"><meta name="twitter:description" content="FileBeat+Kafka+ELK_V6.4.0搭建日志管理平台"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk+filebeat+kafka.png"><meta property="og:type" content="article"><meta property="og:title" content="FileBeat+Kafka+ELK_V6.4.0搭建日志管理平台"><meta property="og:url" content="http://yoursite.com/2019/09/16/FileBeat-Kafka-ELK搭建日志管理平台/"><meta property="og:site_name" content="RenChing"><meta property="og:description" content="FileBeat+Kafka+ELK_V6.4.0搭建日志管理平台"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk+filebeat+kafka.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="CentOS 7 SFTP + Keepalived 高可用文件存储" href="http://yoursite.com/2021/12/25/CentOS-7-SFTP-Keepalived-高可用文件存储/"><link rel="next" title="Centos 7部署YApi可视化接口管理平台" href="http://yoursite.com/2019/08/01/Centos-7部署YApi可视化接口管理平台/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://renqingsangbu.github.io","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Bookmark',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days'

  
}</script></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#FileBeat-Kafka-ELK-V6-4-0搭建日志管理平台"><span class="toc-text">FileBeat+Kafka+ELK_V6.4.0搭建日志管理平台</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-概述"><span class="toc-text">1 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-常见部署架构"><span class="toc-text">2 常见部署架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Logstash作为日志收集器"><span class="toc-text">2.1 Logstash作为日志收集器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Filebeat作为日志收集器"><span class="toc-text">2.2 Filebeat作为日志收集器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-引入Kafka缓存队列的部署架构"><span class="toc-text">2.3 引入Kafka缓存队列的部署架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-三种架构总结"><span class="toc-text">2.4 三种架构总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-环境介绍"><span class="toc-text">3 环境介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-开始安装部署ELK"><span class="toc-text">4 开始安装部署ELK</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-部署前准备"><span class="toc-text">4.1 部署前准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-安装-jdk8"><span class="toc-text">4.2 安装 jdk8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-安装elasticsearch"><span class="toc-text">4.3 安装elasticsearch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-安装并配置-Kafka-zookeeper-集群"><span class="toc-text">4.4 安装并配置 Kafka zookeeper 集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#修改-zookeeper-配置文件"><span class="toc-text">修改 zookeeper 配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-Zookeeper-环境变量"><span class="toc-text">配置 Zookeeper 环境变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-myid-文件"><span class="toc-text">配置 myid 文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-zookeeper"><span class="toc-text">启动 zookeeper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#验证-zookeeper-节点状态"><span class="toc-text">验证 zookeeper 节点状态</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kafka-集群安装与配置"><span class="toc-text">Kafka 集群安装与配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-Kafka-环境变量"><span class="toc-text">配置 Kafka 环境变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-Kafka-配置文件"><span class="toc-text">配置 Kafka 配置文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-启动-zookeeper-集群"><span class="toc-text">4.5 启动 zookeeper 集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-zookeeper-1"><span class="toc-text">启动 zookeeper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#验证-zookeeper-节点状态-1"><span class="toc-text">验证 zookeeper 节点状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-Kafka"><span class="toc-text">启动 Kafka</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#业务服务器-Filebeat"><span class="toc-text">业务服务器+Filebeat</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#定制nginx日志格式"><span class="toc-text">定制nginx日志格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装配置-Filebeat"><span class="toc-text">安装配置 Filebeat</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-Filebeat"><span class="toc-text">启动 Filebeat</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装配置-Logstash"><span class="toc-text">安装配置 Logstash</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-Logstash"><span class="toc-text">启动 Logstash</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装配置-kibana"><span class="toc-text">安装配置 kibana</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#启动-kibana"><span class="toc-text">启动 kibana</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk+filebeat+kafka.png)"><div id="page-header"><span class="pull-left"> <a class="blog_title" id="site-name" href="/">RenChing</a></span><div class="open toggle-menu pull-right"><div class="menu-icon-first"></div><div class="menu-icon-second"></div><div class="menu-icon-third"></div></div><span class="pull-right menus"><div class="mobile_author_icon"><img class="lozad" data-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'"><div class="mobile_author-info__description"></div></div><hr><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标籤</span></a><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title"><div class="posttitle">FileBeat+Kafka+ELK_V6.4.0搭建日志管理平台</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2019-09-16<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> Updated 2021-12-26</time></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="FileBeat-Kafka-ELK-V6-4-0搭建日志管理平台"><a href="#FileBeat-Kafka-ELK-V6-4-0搭建日志管理平台" class="headerlink" title="FileBeat+Kafka+ELK_V6.4.0搭建日志管理平台"></a>FileBeat+Kafka+ELK_V6.4.0搭建日志管理平台</h1><h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h2><p>ELK已经成为目前最流行的集中式日志解决方案，它主要是由Beats、Logstash、Elasticsearch、Kibana等组件组成，来共同完成实时日志的收集，存储，展示等一站式的解决方案。本文将会介绍ELK常见的架构以及相关问题解决。</p>
<p>Filebeat：Filebeat是一款轻量级，占用服务资源非常少的数据收集引擎，它是ELK家族的新成员，可以代替Logstash作为在应用服务器端的日志收集引擎，支持将收集到的数据输出到Kafka，Redis等队列。</p>
<p>Logstash：数据收集引擎，相较于Filebeat比较重量级，但它集成了大量的插件，支持丰富的数据源收集，对收集的数据可以过滤，分析，格式化日志格式。</p>
<p>Elasticsearch：分布式数据搜索引擎，基于Apache Lucene实现，可集群，提供数据的集中式存储，分析，以及强大的数据搜索和聚合功能。</p>
<p>Kibana：数据的可视化平台，通过该web平台可以实时的查看 Elasticsearch 中的相关数据，并提供了丰富的图表统计功能。</p>
<p>Kafka：是一种高吞吐量的分布式发布订阅消息系统，它可以处理消费者规模的网站中的所有动作流数据。</p>
<h2 id="2-常见部署架构"><a href="#2-常见部署架构" class="headerlink" title="2 常见部署架构"></a>2 常见部署架构</h2><h3 id="2-1-Logstash作为日志收集器"><a href="#2-1-Logstash作为日志收集器" class="headerlink" title="2.1 Logstash作为日志收集器"></a>2.1 Logstash作为日志收集器</h3><p>这种架构是比较原始的部署架构，在各应用服务器端分别部署一个Logstash组件，作为日志收集器，然后将Logstash收集到的数据过滤、分析、格式化处理后发送至Elasticsearch存储，最后使用Kibana进行可视化展示，这种架构不足的是：Logstash比较耗服务器资源，所以会增加应用服务器端的负载压力。</p>
<p><img src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk-1.png" alt="img"></p>
<h3 id="2-2-Filebeat作为日志收集器"><a href="#2-2-Filebeat作为日志收集器" class="headerlink" title="2.2 Filebeat作为日志收集器"></a>2.2 Filebeat作为日志收集器</h3><p>该架构与第一种架构唯一不同的是：应用端日志收集器换成了Filebeat，Filebeat轻量，占用服务器资源少，所以使用Filebeat作为应用服务器端的日志收集器，一般Filebeat会配合Logstash一起使用，这种部署方式也是目前最常用的架构。</p>
<p><img src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk-2.png" alt="img"></p>
<h3 id="2-3-引入Kafka缓存队列的部署架构"><a href="#2-3-引入Kafka缓存队列的部署架构" class="headerlink" title="2.3 引入Kafka缓存队列的部署架构"></a>2.3 引入Kafka缓存队列的部署架构</h3><p>该架构在第二种架构的基础上引入了Kafka消息队列（还可以是其他消息队列），将Filebeat收集到的数据发送至Kafka，然后在通过Logstasth读取Kafka中的数据，这种架构主要是解决大数据量下的日志收集方案，使用缓存队列主要是解决数据安全与均衡Logstash与Elasticsearch负载压力。</p>
<p><img src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk-3.png" alt="img"></p>
<h3 id="2-4-三种架构总结"><a href="#2-4-三种架构总结" class="headerlink" title="2.4 三种架构总结"></a>2.4 三种架构总结</h3><p>第一种部署架构由于资源占用问题，现已很少使用，目前使用最多的是第二种部署架构，至于第三种部署架构引入消息队列，除非有其他需求，因为在数据量较大的情况下，Filebeat 使用压力敏感协议向 Logstash 或 Elasticsearch 发送数据。如果 Logstash 正在繁忙地处理数据，它会告知 Filebeat 减慢读取速度。拥塞解决后，Filebeat 将恢复初始速度并继续发送数据。</p>
<h2 id="3-环境介绍"><a href="#3-环境介绍" class="headerlink" title="3 环境介绍"></a>3 环境介绍</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">3.1 软件版本：</span><br><span class="line">- CentOS 7.5</span><br><span class="line">- Java 1.8.0_161</span><br><span class="line">- Elasticsearch 6.4.0</span><br><span class="line">- Logstash 6.4.0</span><br><span class="line">- Filebeat 6.4.0</span><br><span class="line">- Kibana 6.4.0</span><br><span class="line">- Kafka 2.3.0</span><br><span class="line">- Zookeeper 3.4.14</span><br><span class="line"></span><br><span class="line">3.2 服务器：</span><br><span class="line">- 172.16.0.179    elk-node1</span><br><span class="line">- 172.16.0.67        elk-node2</span><br><span class="line">- 172.16.1.115    elk-node3</span><br><span class="line"></span><br><span class="line">3.3 部署角色：</span><br><span class="line">- elasticsearch：172.16.0.179、172.16.0.67、172.16.1.115</span><br><span class="line">Elasticsearch 允许执行和合并多种类型的搜索 （ 结构化、非结构化、地理位置、度量指标 ）搜索方式。</span><br><span class="line"></span><br><span class="line">- logstash：172.16.0.179</span><br><span class="line">Logstash 支持各种输入选择 ，可以在同一时间从众多常用来源捕捉事件。</span><br><span class="line"></span><br><span class="line">- kibana：172.16.0.179</span><br><span class="line">Kibana 让您能够可视化 Elasticsearch 中的数据并操作 Elastic Stack。</span><br><span class="line"></span><br><span class="line">- Filebeat：172.16.0.179、172.16.0.67、172.16.1.115</span><br><span class="line">Filebeat 内置的多种模块（auditd、Apache、NGINX、System 和 MySQL）可实现对常见日志格式的一键收集、解析和可视化。</span><br><span class="line"></span><br><span class="line">- Kafka：172.16.0.179、172.16.0.67、172.16.1.115</span><br><span class="line">Kafka是一种高吞吐量的分布式发布订阅消息系统，它可以处理消费者规模的网站中的所有动作流数据。</span><br></pre></td></tr></table></figure>

<h2 id="4-开始安装部署ELK"><a href="#4-开始安装部署ELK" class="headerlink" title="4 开始安装部署ELK"></a>4 开始安装部署ELK</h2><h3 id="4-1-部署前准备"><a href="#4-1-部署前准备" class="headerlink" title="4.1 部署前准备"></a>4.1 部署前准备</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">修改主机名(三台机器依次修改)：</span><br><span class="line">$ vim /etc/hostname</span><br><span class="line">elk-node1</span><br><span class="line"></span><br><span class="line">$ hostname elk-node1</span><br><span class="line">$ bash</span><br><span class="line"></span><br><span class="line">$ hostname</span><br><span class="line">elk-node1</span><br><span class="line"></span><br><span class="line">$ cat /etc/hosts</span><br><span class="line">172.16.0.179    elk-node1</span><br><span class="line">172.16.0.67     elk-node2</span><br><span class="line">172.16.1.115    elk-node2</span><br><span class="line"></span><br><span class="line">$ systemctl stop firewalld</span><br><span class="line">$ systemctl disable firewalld</span><br><span class="line"></span><br><span class="line">$ vim /etc/security/limits.conf</span><br><span class="line">以下内容添加到末尾处</span><br><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 65536</span><br><span class="line"></span><br><span class="line">$ vim /etc/sysctl.conf </span><br><span class="line">以下内容添加到末尾处</span><br><span class="line">vm.max_map_count = 655360</span><br><span class="line">$ sysctl -p</span><br></pre></td></tr></table></figure>

<h3 id="4-2-安装-jdk8"><a href="#4-2-安装-jdk8" class="headerlink" title="4.2 安装 jdk8"></a>4.2 安装 jdk8</h3><p>Kafka使用Zookeeper来保存相关配置信息，Kafka及Zookeeper依赖Java环境，有关CentOS7.0安装JDK请参考：<a href="http://blog.csdn.net/jssg_tzw/article/details/70241743" target="_blank" rel="noopener">CentOS 7 安装JDK1.8</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CentOS 7 自带 jdk 版本为 1.8.0_161 ，在此跳过安装 jdk。</span><br></pre></td></tr></table></figure>

<h3 id="4-3-安装elasticsearch"><a href="#4-3-安装elasticsearch" class="headerlink" title="4.3 安装elasticsearch"></a>4.3 安装elasticsearch</h3><p><strong>创建 elk 用户及相应的目录（三台同样操作）</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ useradd elk</span><br><span class="line">$ passwd elk</span><br><span class="line">$ mkdir /usr/elk</span><br><span class="line">$ mkdir /elk</span><br></pre></td></tr></table></figure>

<p><strong>解压源码包</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">node1操作</span><br><span class="line">$ tar xf elasticsearch-6.4.2.tar.gz  -C /usr/elk/</span><br><span class="line">$ tar xf logstash-6.4.2.tar.gz -C /usr/elk/</span><br><span class="line">$ tar xf kibana-6.4.2-linux-x86_64.tar.gz -C /usr/elk/</span><br><span class="line">$ tar xf filebeat-6.4.2-linux-x86_64.tar.gz  -C /usr/elk/ </span><br><span class="line">$    tar xf kafka_2.11-2.3.0.tgz -C /usr/elk/</span><br><span class="line">$ tar xf zookeeper-3.4.14.tar.gz -C /usr/elk</span><br><span class="line"></span><br><span class="line">node2操作</span><br><span class="line">$ tar xf elasticsearch-6.4.2.tar.gz  -C /usr/elk/</span><br><span class="line">$ tar xf filebeat-6.4.2-linux-x86_64.tar.gz  -C /usr/elk/</span><br><span class="line">$    tar xf kafka_2.11-2.3.0.tgz -C /usr/elk/</span><br><span class="line">$ tar xf zookeeper-3.4.14.tar.gz -C /usr/elk</span><br><span class="line"></span><br><span class="line">node3操作</span><br><span class="line">$ tar xf elasticsearch-6.4.2.tar.gz  -C /usr/elk/</span><br><span class="line">$ tar xf filebeat-6.4.2-linux-x86_64.tar.gz  -C /usr/elk/</span><br><span class="line">$    tar xf kafka_2.11-2.3.0.tgz -C /usr/elk/</span><br><span class="line">$ tar xf zookeeper-3.4.14.tar.gz -C /usr/elk</span><br></pre></td></tr></table></figure>

<p><strong>修改 elk 属主、属组</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node1-node3操作</span><br><span class="line">$ chown -R elk:elk /usr/elk/</span><br><span class="line">$ chown -R elk:elk /elk/</span><br></pre></td></tr></table></figure>

<p><strong>切换 elk 用户用户进行安装</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ su - elk</span><br><span class="line"></span><br><span class="line">创建数据目录和日志目录（三台同样操作）</span><br><span class="line">$ mkdir -p /elk/es/data</span><br><span class="line">$ mkdir -p /elk/es/logs</span><br><span class="line"></span><br><span class="line">$ ll /elk/</span><br><span class="line">总用量 0</span><br><span class="line">drwxrwxr-x 4 elk elk 30 8月  29 18:09 es</span><br><span class="line"></span><br><span class="line">$ ll /elk/es/</span><br><span class="line">总用量 0</span><br><span class="line">drwxrwxr-x 2 elk elk 6 8月  29 18:09 data</span><br><span class="line">drwxrwxr-x 2 elk elk 6 8月  29 18:09 logs</span><br></pre></td></tr></table></figure>

<p><strong>修改elasticsearch.yml配置文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">elk-node1</span><br><span class="line">$ grep -v &quot;^#&quot; /usr/elk/elasticsearch-6.4.2/config/elasticsearch.yml                                              </span><br><span class="line">cluster.name: my-es-cluster</span><br><span class="line">node.name: elk-node1</span><br><span class="line">path.data: /elk/es/data/elk_data</span><br><span class="line">path.logs: /elk/es/logs/elk_logs</span><br><span class="line">bootstrap.memory_lock: false</span><br><span class="line">bootstrap.system_call_filter: false</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">node.master: true</span><br><span class="line">node.data: true</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;elk-node1&quot;, &quot;elk-node2&quot;,&quot;elk-node3&quot;]</span><br><span class="line">discovery.zen.minimum_master_nodes: 1</span><br><span class="line">http.cors.enabled: true                         </span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line"></span><br><span class="line">elk-node2</span><br><span class="line">$ grep -v &quot;^#&quot; /usr/elk/elasticsearch-6.4.2/config/elasticsearch.yml</span><br><span class="line">cluster.name: my-es-cluster</span><br><span class="line">node.name: elk-node2</span><br><span class="line">path.data: /elk/es/data/elk_data</span><br><span class="line">path.logs: /elk/es/logs/elk_logs</span><br><span class="line">bootstrap.memory_lock: false</span><br><span class="line">bootstrap.system_call_filter: false</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">node.master: false</span><br><span class="line">node.data: true</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;elk-node1&quot;, &quot;elk-node2&quot;,&quot;elk-node3&quot;]</span><br><span class="line">discovery.zen.minimum_master_nodes: 1</span><br><span class="line"></span><br><span class="line">elk-node3</span><br><span class="line">$ grep -v &quot;^#&quot; /usr/elk/elasticsearch-6.4.2/config/elasticsearch.yml </span><br><span class="line">cluster.name: my-es-cluster</span><br><span class="line">node.name: elk-node3</span><br><span class="line">path.data: /elk/es/data/elk_data</span><br><span class="line">path.logs: /elk/es/logs/elk_logs</span><br><span class="line">bootstrap.memory_lock: false</span><br><span class="line">bootstrap.system_call_filter: false</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">node.master: false</span><br><span class="line">node.data: true</span><br><span class="line">discovery.zen.ping.unicast.hosts: [&quot;elk-node1&quot;, &quot;elk-node2&quot;,&quot;elk-node3&quot;]</span><br><span class="line">discovery.zen.minimum_master_nodes: 1</span><br></pre></td></tr></table></figure>

<p><strong>启动elasticsearch</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">三台都启动</span><br><span class="line">$ cd /usr/elk/elasticsearch-6.4.2</span><br><span class="line">$ nohup ./bin/elasticsearch &amp;</span><br><span class="line"></span><br><span class="line">检查服务是否启动成功</span><br><span class="line">$ ss -tanl | egrep &quot;9200|9300&quot;</span><br><span class="line">LISTEN     0      128         :::9200                    :::*                  </span><br><span class="line">LISTEN     0      128         :::9300                    :::*</span><br></pre></td></tr></table></figure>

<p><strong>浏览器访问9200端口查看节点信息情况</strong></p>
<p><a href="http://172.16.0.179:9200" target="_blank" rel="noopener">http://172.16.0.179:9200</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk-node1.png" alt="img"></p>
<p><a href="http://172.16.0.67:9200" target="_blank" rel="noopener">http://172.16.0.67:9200</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk-node2.png" alt="img"></p>
<p><a href="http://172.16.1.115:9200" target="_blank" rel="noopener">http://172.16.1.115:9200</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk-node3.png" alt="img"></p>
<p><strong>查看集群健康状态(status为green代表集群健康)</strong></p>
<p><a href="http://172.16.0.179:9200/_cluster/health?pretty" target="_blank" rel="noopener">http://172.16.0.179:9200/_cluster/health?pretty</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk-cluster_health.png" alt="img"></p>
<p><strong>安装elasticsearch-head插件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">elk-node1操作(可使用root用户安装)</span><br><span class="line">$ tar xf node-v8.2.1-linux-x64.tar.gz -C /usr/elk/</span><br><span class="line">$ ln -s /usr/elk/node-v8.2.1-linux-x64/bin/node /usr/bin/node</span><br><span class="line">$ ln -s /usr/elk/node-v8.2.1-linux-x64/bin/npm /usr/bin/npm</span><br><span class="line"></span><br><span class="line">$ npm -v</span><br><span class="line">5.3.0</span><br><span class="line">$ node -v</span><br><span class="line">v8.2.1</span><br><span class="line"></span><br><span class="line">$ npm install -g grunt-cli</span><br><span class="line">$ ln -s /usr/elk/node-v8.2.1-linux-x64/lib/node_modules/grunt-cli/bin/grunt /usr/bin/grunt</span><br><span class="line"></span><br><span class="line">$ tar xf elasticsearch-head.tar.gz -C /usr/elk/</span><br><span class="line">$ cd /usr/elk/elasticsearch-head/</span><br><span class="line">$ npm install </span><br><span class="line"></span><br><span class="line">$ cd _site/</span><br><span class="line">$ vim app.js</span><br><span class="line">//修改4329行</span><br><span class="line">this.base_uri = this.config.base_uri || this.prefs.get(&quot;app-base_uri&quot;) || &quot;http://修改成本机IP:9200&quot;;</span><br></pre></td></tr></table></figure>

<p><strong>启动 elasticsearch-head</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/elk/elasticsearch-head/_site</span><br><span class="line">$ npm run start &amp;</span><br></pre></td></tr></table></figure>

<p><strong>浏览器访问9100端口查看集群状态信息</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk-cluster_status.png" alt="img"></p>
<p><strong>可以通过命令插入一个测试索引，索引为index-demo,类型为test</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -XPUT &apos;localhost:9200/index-demo/test/1?pretty&amp;pretty&apos; -H &apos;Content-Type: application/json&apos; -d &apos;&#123; &quot;user&quot;: &quot;zhangsan&quot;,&quot;mesg&quot;:&quot;hello world&quot; &#125;&apos;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk-test-input.png" alt="img"></p>
<p><strong>刷新浏览器可以看到成功创建索引</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk-cluster_status-1.png" alt="img"></p>
<p><strong>到此elasticsearch已完成安装</strong></p>
<h3 id="4-4-安装并配置-Kafka-zookeeper-集群"><a href="#4-4-安装并配置-Kafka-zookeeper-集群" class="headerlink" title="4.4 安装并配置 Kafka zookeeper 集群"></a>4.4 安装并配置 Kafka zookeeper 集群</h3><p>zookeeper 下载地址：<a href="https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz</a></p>
<h4 id="修改-zookeeper-配置文件"><a href="#修改-zookeeper-配置文件" class="headerlink" title="修改 zookeeper 配置文件"></a><strong>修改 zookeeper 配置文件</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(node1-node3)</span><br><span class="line"></span><br><span class="line">$ mkdir /elk/es/data/zoo_data</span><br><span class="line"></span><br><span class="line">$ cd /usr/elk/zookeeper-3.4.14/conf/</span><br><span class="line">$ cp zoo_sample.cfg zoo.cfg</span><br><span class="line">$ grep -v &quot;^#&quot; zoo.cfg </span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=10</span><br><span class="line">syncLimit=5</span><br><span class="line">dataDir=/elk/es/data/zoo_data/</span><br><span class="line">clientPort=2181</span><br></pre></td></tr></table></figure>

<h4 id="配置-Zookeeper-环境变量"><a href="#配置-Zookeeper-环境变量" class="headerlink" title="配置 Zookeeper 环境变量"></a><strong>配置 Zookeeper 环境变量</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(node1-node3)</span><br><span class="line"></span><br><span class="line">$ vim /etc/profile</span><br><span class="line">末尾处添加一下内容</span><br><span class="line">ZOOKEEPER_HOME=/usr/elk/zookeeper-3.4.14</span><br><span class="line">PATH=$PATH:ZOOKEEPER_HOME/bin</span><br><span class="line">export ZOOKEEPER_HOME</span><br><span class="line"></span><br><span class="line">保存修改</span><br><span class="line">$ source /etc/profile</span><br></pre></td></tr></table></figure>

<h4 id="配置-myid-文件"><a href="#配置-myid-文件" class="headerlink" title="配置 myid 文件"></a><strong>配置 myid 文件</strong></h4><p>除了修改 zoo.cfg 配置文件，集群模式下还要配置一个文件 myid，这个文件在 上述dataDir 指定的目录下，这个文件里面就只有一个数据就是 A 的值，Zookeeper 启动时会读取这个文件，拿到里面的数据与 zoo.cfg 里面的配置信息比较从而判断到底是那个 server。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">node1</span><br><span class="line">$ echo &quot;1&quot; &gt;&gt; /elk/es/data/zoo_data/myid</span><br><span class="line">node2</span><br><span class="line">$ echo &quot;2&quot; &gt;&gt; /elk/es/data/zoo_data/myid</span><br><span class="line">node3</span><br><span class="line">$ echo &quot;3&quot; &gt;&gt; /elk/es/data/zoo_data/myid</span><br></pre></td></tr></table></figure>

<h4 id="启动-zookeeper"><a href="#启动-zookeeper" class="headerlink" title="启动 zookeeper"></a>启动 zookeeper</h4><p>在 ZooKeeper 集群的每个结点上，执行启动ZooKeeper服务的脚本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(node1-node3)</span><br><span class="line"></span><br><span class="line">$ cd /usr/elk/zookeeper-3.4.14/bin/</span><br><span class="line">$ ./zkServer.sh start</span><br></pre></td></tr></table></figure>

<h4 id="验证-zookeeper-节点状态"><a href="#验证-zookeeper-节点状态" class="headerlink" title="验证 zookeeper 节点状态"></a>验证 zookeeper 节点状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(node1-node3)</span><br><span class="line"></span><br><span class="line">$ ./zkServer.sh status</span><br><span class="line">$ ss -tanl | grep 2181</span><br><span class="line">LISTEN     0      50          :::2181                    :::*</span><br></pre></td></tr></table></figure>

<h3 id="Kafka-集群安装与配置"><a href="#Kafka-集群安装与配置" class="headerlink" title="Kafka 集群安装与配置"></a><strong>Kafka 集群安装与配置</strong></h3><p>Kafka下载地址：<a href="https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.3.0/kafka_2.11-2.3.0.tgz" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.3.0/kafka_2.11-2.3.0.tgz</a></p>
<h4 id="配置-Kafka-环境变量"><a href="#配置-Kafka-环境变量" class="headerlink" title="配置 Kafka 环境变量"></a>配置 Kafka 环境变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/profile</span><br><span class="line">末尾处添加一下内容</span><br><span class="line">KAFKA_HOME=/usr/elk/kafka_2.11-2.3.0/</span><br><span class="line">PATH=$PATH:$KAFKA_HOME/bin</span><br><span class="line">export PATH KAFKA_HOME</span><br><span class="line"></span><br><span class="line">保存修改</span><br><span class="line">$ source /etc/profile</span><br></pre></td></tr></table></figure>

<h4 id="配置-Kafka-配置文件"><a href="#配置-Kafka-配置文件" class="headerlink" title="配置 Kafka 配置文件"></a>配置 Kafka 配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">创建日志存放目录</span><br><span class="line">$ mkdir -p /elk/es/logs/kafka</span><br><span class="line"></span><br><span class="line">修改配置文件</span><br><span class="line">node1</span><br><span class="line">$ grep -E -v &quot;^#|^$&quot; /usr/elk/kafka_2.11-2.3.0/config/server.properties</span><br><span class="line">broker.id=181</span><br><span class="line">delete.topic.enable=true</span><br><span class="line">listeners = PLAINTEXT://172.16.0.179:9092</span><br><span class="line">num.network.threads=3</span><br><span class="line">num.io.threads=8</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line">log.dirs=/elk/es/logs/kafka</span><br><span class="line">num.partitions=1</span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line">log.retention.hours=168</span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line">zookeeper.connect=172.16.0.179:2181,172.16.0.67:2181,172.16.1.115:2181</span><br><span class="line">zookeeper.connection.timeout.ms=6000</span><br><span class="line">group.initial.rebalance.delay.ms=0</span><br><span class="line"></span><br><span class="line">node2</span><br><span class="line">$ grep -E -v &quot;^#|^$&quot; /usr/elk/kafka_2.11-2.3.0/config/server.properties</span><br><span class="line">broker.id=182</span><br><span class="line">delete.topic.enable=true</span><br><span class="line">listeners = PLAINTEXT://172.16.0.67:9092</span><br><span class="line">num.network.threads=3</span><br><span class="line">num.io.threads=8</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line">log.dirs=/elk/es/logs/kafka</span><br><span class="line">num.partitions=1</span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line">log.retention.hours=168</span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line">zookeeper.connect=172.16.0.179:2181,172.16.0.67:2181,172.16.1.115:2181</span><br><span class="line">zookeeper.connection.timeout.ms=6000</span><br><span class="line">group.initial.rebalance.delay.ms=0</span><br><span class="line"></span><br><span class="line">node3</span><br><span class="line">$ grep -E -v &quot;^#|^$&quot; /usr/elk/kafka_2.11-2.3.0/config/server.properties</span><br><span class="line">broker.id=183</span><br><span class="line">delete.topic.enable=true</span><br><span class="line">listeners = PLAINTEXT://172.16.1.115:9092</span><br><span class="line">num.network.threads=3</span><br><span class="line">num.io.threads=8</span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line">log.dirs=/elk/es/logs/kafka</span><br><span class="line">num.partitions=1</span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line">transaction.state.log.replication.factor=1</span><br><span class="line">transaction.state.log.min.isr=1</span><br><span class="line">log.retention.hours=168</span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line">zookeeper.connect=172.16.0.179:2181,172.16.0.67:2181,172.16.1.115:2181</span><br><span class="line">zookeeper.connection.timeout.ms=6000</span><br><span class="line">group.initial.rebalance.delay.ms=0</span><br></pre></td></tr></table></figure>

<p>注: 其他两个节点的配置文件也基本相同，只有一个参数需要修改 broker.id 。 它用于唯一标识节点，所以绝对不能相同，不然会节点冲突。</p>
<h3 id="4-5-启动-zookeeper-集群"><a href="#4-5-启动-zookeeper-集群" class="headerlink" title="4.5 启动 zookeeper 集群"></a>4.5 启动 zookeeper 集群</h3><h4 id="启动-zookeeper-1"><a href="#启动-zookeeper-1" class="headerlink" title="启动 zookeeper"></a>启动 zookeeper</h4><p>在 ZooKeeper 集群的每个结点上，执行启动ZooKeeper服务的脚本启动zookeeper。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(node1-node3)</span><br><span class="line"></span><br><span class="line">$ cd /usr/elk/zookeeper-3.4.14/bin/</span><br><span class="line">$ ./zkServer.sh start</span><br></pre></td></tr></table></figure>

<h4 id="验证-zookeeper-节点状态-1"><a href="#验证-zookeeper-节点状态-1" class="headerlink" title="验证 zookeeper 节点状态"></a>验证 zookeeper 节点状态</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(node1-node3)</span><br><span class="line"></span><br><span class="line">$ ./zkServer.sh start</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/elk/zookeeper-3.4.14/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line"></span><br><span class="line">$ ./zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /usr/elk/zookeeper-3.4.14/bin/../conf/zoo.cfg</span><br><span class="line">Mode: standalone</span><br><span class="line"></span><br><span class="line">$ ss -tanl | grep 2181</span><br><span class="line">LISTEN     0      50          :::2181                    :::*</span><br></pre></td></tr></table></figure>

<h4 id="启动-Kafka"><a href="#启动-Kafka" class="headerlink" title="启动 Kafka"></a>启动 Kafka</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(node1-node3)</span><br><span class="line"></span><br><span class="line">$ kafka-server-start.sh /usr/elk/kafka_2.11-2.3.0/config/server.properties</span><br></pre></td></tr></table></figure>

<p>到此kafka+zookeeper集群已搭建完成。</p>
<h3 id="业务服务器-Filebeat"><a href="#业务服务器-Filebeat" class="headerlink" title="业务服务器+Filebeat"></a>业务服务器+Filebeat</h3><h4 id="定制nginx日志格式"><a href="#定制nginx日志格式" class="headerlink" title="定制nginx日志格式"></a>定制nginx日志格式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(node1-node3)</span><br><span class="line"></span><br><span class="line">log_format log_json &apos;&#123; &quot;@timestamp&quot;: &quot;$time_local&quot;, &apos;</span><br><span class="line">&apos;&quot;remote_addr&quot;: &quot;$remote_addr&quot;, &apos;</span><br><span class="line">&apos;&quot;referer&quot;: &quot;$http_referer&quot;, &apos;</span><br><span class="line">&apos;&quot;request&quot;: &quot;$request&quot;, &apos;</span><br><span class="line">&apos;&quot;status&quot;: $status, &apos;</span><br><span class="line">&apos;&quot;bytes&quot;: $body_bytes_sent, &apos;</span><br><span class="line">&apos;&quot;agent&quot;: &quot;$http_user_agent&quot;, &apos;</span><br><span class="line">&apos;&quot;x_forwarded&quot;: &quot;$http_x_forwarded_for&quot;, &apos;</span><br><span class="line">&apos;&quot;up_addr&quot;: &quot;$upstream_addr&quot;,&apos;</span><br><span class="line">&apos;&quot;up_host&quot;: &quot;$upstream_http_host&quot;,&apos;</span><br><span class="line">&apos;&quot;up_resp_time&quot;: &quot;$upstream_response_time&quot;,&apos;</span><br><span class="line">&apos;&quot;request_time&quot;: &quot;$request_time&quot;&apos;</span><br><span class="line">&apos; &#125;&apos;;</span><br><span class="line"></span><br><span class="line">access_log  /var/log/nginx/access.log  log_json;</span><br><span class="line"></span><br><span class="line">启动nginx</span><br><span class="line">$ nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br><span class="line"></span><br><span class="line">$ nginx</span><br><span class="line"></span><br><span class="line">$ netstat -anpt | grep 80</span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      114490/nginx: maste</span><br></pre></td></tr></table></figure>

<h4 id="安装配置-Filebeat"><a href="#安装配置-Filebeat" class="headerlink" title="安装配置 Filebeat"></a>安装配置 Filebeat</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">(node1-node3)</span><br><span class="line"></span><br><span class="line">$ cd /usr/elk/filebeat-6.4.2-linux-x86_64/</span><br><span class="line"></span><br><span class="line">node1</span><br><span class="line">$ cat filebeat.yml</span><br><span class="line">filebeat.inputs:</span><br><span class="line">- type: log</span><br><span class="line">enabled: true</span><br><span class="line">paths:</span><br><span class="line">- /var/log/nginx/access.log</span><br><span class="line">tags: [&quot;node1_accesslog&quot;]</span><br><span class="line"></span><br><span class="line">output.kafka:</span><br><span class="line">enabled: true</span><br><span class="line">hosts: [&quot;172.16.0.179:9092,172.16.0.67:9092,172.16.1.115:9092&quot;]</span><br><span class="line">topic: elk</span><br><span class="line"></span><br><span class="line">node2</span><br><span class="line">$ cat filebeat.yml</span><br><span class="line">filebeat.inputs:</span><br><span class="line">- type: log</span><br><span class="line">enabled: true</span><br><span class="line">paths:</span><br><span class="line">- /var/log/nginx/access.log</span><br><span class="line">tags: [&quot;node2_accesslog&quot;]</span><br><span class="line"></span><br><span class="line">output.kafka:</span><br><span class="line">enabled: true</span><br><span class="line">hosts: [&quot;172.16.0.179:9092,172.16.0.67:9092,172.16.1.115:9092&quot;]</span><br><span class="line">topic: elk</span><br><span class="line"></span><br><span class="line">node3</span><br><span class="line">$ cat filebeat.yml</span><br><span class="line">filebeat.inputs:</span><br><span class="line">- type: log</span><br><span class="line">enabled: true</span><br><span class="line">paths:</span><br><span class="line">- /var/log/nginx/access.log</span><br><span class="line">tags: [&quot;node3_accesslog&quot;]</span><br><span class="line"></span><br><span class="line">output.kafka:</span><br><span class="line">enabled: true</span><br><span class="line">hosts: [&quot;172.16.0.179:9092,172.16.0.67:9092,172.16.1.115:9092&quot;]</span><br><span class="line">topic: elk</span><br></pre></td></tr></table></figure>

<h4 id="启动-Filebeat"><a href="#启动-Filebeat" class="headerlink" title="启动 Filebeat"></a>启动 Filebeat</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/elk/filebeat-6.4.2-linux-x86_64/</span><br><span class="line">$ nohup ./filebeat -e -c /usr/elk/filebeat-6.4.2-linux-x86_64/filebeat.yml &amp;</span><br></pre></td></tr></table></figure>

<h3 id="安装配置-Logstash"><a href="#安装配置-Logstash" class="headerlink" title="安装配置 Logstash"></a>安装配置 Logstash</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">node1</span><br><span class="line"></span><br><span class="line">$ cd /usr/elk/logstash-6.4.2/</span><br><span class="line">$ cp config/logstash-sample.conf config/logstash.conf</span><br><span class="line">$ grep -v &quot;^#&quot; config/access_log.conf       </span><br><span class="line"></span><br><span class="line">input &#123;</span><br><span class="line">kafka &#123;</span><br><span class="line">type =&gt; &quot;kafka-logs&quot;</span><br><span class="line">bootstrap_servers =&gt; &quot;172.16.0.179:9092,172.16.0.67:9092,172.16.1.115:9092&quot;</span><br><span class="line">group_id =&gt; &quot;logstash&quot;</span><br><span class="line">auto_offset_reset =&gt; &quot;earliest&quot;</span><br><span class="line">topics =&gt; &quot;elk&quot;</span><br><span class="line">consumer_threads =&gt; 5</span><br><span class="line">decorate_events =&gt; true</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line">if &quot;node1_accesslog&quot; in [tags] &#123;</span><br><span class="line">elasticsearch &#123;</span><br><span class="line">hosts =&gt; [&quot;172.16.0.179:9200&quot;,&quot;172.16.0.67:9200&quot;,&quot;172.16.1.115:9200&quot;]</span><br><span class="line">index =&gt; &quot;node1_access_json-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if &quot;node2_accesslog&quot; in [tags] &#123;</span><br><span class="line">elasticsearch &#123;</span><br><span class="line">hosts =&gt; [&quot;172.16.0.179:9200&quot;,&quot;172.16.0.67:9200&quot;,&quot;172.16.1.115:9200&quot;]</span><br><span class="line">index =&gt; &quot;node2_access_json-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if &quot;node3_accesslog&quot; in [tags] &#123;</span><br><span class="line">elasticsearch &#123;</span><br><span class="line">hosts =&gt; [&quot;172.16.0.179:9200&quot;,&quot;172.16.0.67:9200&quot;,&quot;172.16.1.115:9200&quot;]</span><br><span class="line">index =&gt; &quot;node3_access_json-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="启动-Logstash"><a href="#启动-Logstash" class="headerlink" title="启动 Logstash"></a>启动 Logstash</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr/elk/logstash-6.4.2/</span><br><span class="line">$ nohup ./bin/logstash -f config/access_log.conf &amp;</span><br></pre></td></tr></table></figure>

<h3 id="安装配置-kibana"><a href="#安装配置-kibana" class="headerlink" title="安装配置 kibana"></a>安装配置 kibana</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/elk/kibana-6.4.2-linux-x86_64/</span><br><span class="line"></span><br><span class="line">$ grep  -E -v &quot;^#|^$&quot; config/kibana.yml </span><br><span class="line">server.port: 5601</span><br><span class="line">server.host: &quot;172.16.0.179&quot;</span><br><span class="line">elasticsearch.url: &quot;http://172.16.0.179:9200&quot;</span><br></pre></td></tr></table></figure>

<h4 id="启动-kibana"><a href="#启动-kibana" class="headerlink" title="启动 kibana"></a>启动 kibana</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ./bin/kibana &amp;</span><br></pre></td></tr></table></figure>

<p>到此已安装完所有。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">RenChing Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2019/09/16/FileBeat-Kafka-ELK搭建日志管理平台/">http://yoursite.com/2019/09/16/FileBeat-Kafka-ELK搭建日志管理平台/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ELK/">ELK    </a><a class="post-meta__tags" href="/tags/Kafka/">Kafka    </a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk+filebeat+kafka.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-buttom"><i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/alipay.jpg"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2021/12/25/CentOS-7-SFTP-Keepalived-高可用文件存储/"><img class="prev_cover lozad" data-src="https://img-blog.csdnimg.cn/2c5809b2e4f34641b5d5a727439a746b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Previous Post</div><div class="prev_info"><span>CentOS 7 SFTP + Keepalived 高可用文件存储</span></div></a></div><div class="next-post pull-right"><a href="/2019/08/01/Centos-7部署YApi可视化接口管理平台/"><img class="next_cover lozad" data-src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/Yapi/yapi_bg.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>Centos 7部署YApi可视化接口管理平台</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span>Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2021/12/26/FileBeat-Kafka-ELK-V7-11-0搭建日志管理平台/" title="FileBeat+Kafka+ELK_V7.11.0搭建日志管理平台"><img class="relatedPosts_cover lozad" data-src="https://cdn.jsdelivr.net/gh/renqingsangbu/cdn@elk1/images/elk/elk+filebeat+kafka.png"><div class="relatedPosts_title">FileBeat+Kafka+ELK_V7.11.0搭建日志管理平台</div></a></div><div class="relatedPosts_item"><a href="/2021/12/26/Elasticsearch7-x-x开启X-pack鉴权/" title="Elasticsearch7.x.x开启X-pack鉴权"><img class="relatedPosts_cover lozad" data-src="https://img-blog.csdnimg.cn/925fc0751167442381ca7e0bc089776d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAUmVuQ2hpbmc=,size_20,color_FFFFFF,t_70,g_se,x_16"><div class="relatedPosts_title">Elasticsearch7.x.x开启X-pack鉴权</div></a></div></div><div class="clear_both"></div></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2021 By RenChing Doe</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://renqingsangbu.github.io/">blog</a>!</div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-book" id="readmode" title="Read Mode"> </i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion">繁</a><i class="fa fa-moon-o nightshift" id="nightshift" title="Dark Mode"></i></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="/js/nightshift.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zindex="-1" data-click="false"></script><script src="/js/activate-power-mode.js"></script><script>POWERMODE.colorful = true; // make power mode colorful
POWERMODE.shake = true; // turn off shake
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script></body></html>